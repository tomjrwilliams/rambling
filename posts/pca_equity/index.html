<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.321">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tom Williams">
<meta name="dcterms.date" content="2023-08-08">

<title>rambling - PCA: Equity Returns</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="https://cdn.plot.ly/plotly-2.9.0.min.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax) {MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.9.0.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>



<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">rambling</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tomjrwilliams" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/tomjrwilliams/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/tjrwilliams" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">PCA: Equity Returns</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Tom Williams </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 8, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>In this post, we try out using PCA to extract market factors from daily equity returns.</p>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jax</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jax.numpy</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xtuples <span class="im">as</span> xt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xfactors <span class="im">as</span> xf</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bt.data.prices.<span class="bu">int</span> <span class="im">as</span> prices</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bt.algos.universe.<span class="bu">int</span> <span class="im">as</span> universe</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bt.algos.universe.configs <span class="im">as</span> configs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>We’ll start by loading some daily close to close total returns data, given a rolling universe of major european equity indices:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df_returns <span class="op">=</span> prices.returns_df(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    xf.dates.y(<span class="dv">2005</span>),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    xf.dates.y(<span class="dv">2023</span>, m<span class="op">=</span><span class="dv">4</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    indices<span class="op">=</span>configs.INDICES,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The returns are from bloomberg, and include all cash and non-cash adjustments (in production we have a separate internal ticker for the dividend stream from a given name, but that’s a little over-complicated for our purposes here).</p>
<p>We’ll also load the relevant index membership mapping tables for our universe:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dfs_indices <span class="op">=</span> universe.rolling_indices(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    xf.dates.y(<span class="dv">2005</span>),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    xf.dates.y(<span class="dv">2023</span>, m<span class="op">=</span><span class="dv">4</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    indices<span class="op">=</span>configs.INDICES,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>df_universe <span class="op">=</span> universe.index_union(dfs_indices)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And some GICS sector mapping tables, as these will be useful later:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dfs_sectors <span class="op">=</span> universe.rolling_indices(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    xf.dates.y(<span class="dv">2005</span>),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    xf.dates.y(<span class="dv">2023</span>, m<span class="op">=</span><span class="dv">4</span>),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    sectors<span class="op">=</span>configs.GICS_SECTORS,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vanilla PCA doesn’t accomodate missing data, so given a particular target date range, we’ll filter to only those tickers within our universe for the entire period, as so:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> in_universe(ticker, df, threshold <span class="op">=</span> <span class="fl">1.</span>):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ticker <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        df[ticker].<span class="bu">sum</span>() <span class="op">/</span> <span class="bu">len</span>(df.index)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">&gt;=</span> threshold</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Which we’ll then wrap into a convenience function.</p>
<div class="cell" data-execution_count="8">
<details>
<summary>get_returns</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_returns(d_start, d_end, threshold<span class="op">=</span><span class="fl">1.</span>):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    tickers <span class="op">=</span> xt.iTuple(df_returns.columns).<span class="bu">filter</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>        in_universe,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        df<span class="op">=</span>xf.dfs.index_date_filter(df_universe, d_start, d_end),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        threshold<span class="op">=</span>threshold,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    ).pipe(<span class="bu">list</span>) </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> xf.dfs.index_date_filter(</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        df_returns, d_start, d_end</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    )[tickers].dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="model" class="level3">
<h3 class="anchored" data-anchor-id="model">Model</h3>
<p><a href="../../posts/pca/index.html">PCA</a> uses eigendecomposition to extract an <a href="../../posts/orthogonality/index.html">orthogonal</a> embedding matrix, together with a diagonal scaling matrix, from the covariance matrix of a given data set.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> functools</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="at">@functools.lru_cache</span>(maxsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_pca(d_start, d_end, n):</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> get_returns(d_start, d_end)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    eigvals, eigvecs <span class="op">=</span> jax.numpy.linalg.eig(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        jax.numpy.cov(df.values.T)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    order <span class="op">=</span> jax.numpy.flip(jax.numpy.argsort(eigvals))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    eigvals <span class="op">=</span> eigvals.real[order[:n]]</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    eigvecs <span class="op">=</span> eigvecs.real[:, order[:n]]</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> eigvals, eigvecs, df</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> fit_pca(xf.dates.y(<span class="dv">2022</span>), xf.dates.y(<span class="dv">2023</span>), n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No GPU/TPU found, falling back to CPU. (Set TF_CPP_MIN_LOG_LEVEL=0 and rerun for more info.)</code></pre>
</div>
</div>
<p>The embedding matrix can then be used to project the data into a lower dimensional factor space, where the relative ‘importance’ of each factor is given by the relevant term in the diagonal scaling matrix (importance being defined as how much of the original data variance each factor ‘explains’).</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> functools</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> apply_pca(d_start, d_end, n):</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    eigvals, eigvecs, df <span class="op">=</span> fit_pca(d_start, d_end, n)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> eigvals, eigvecs, df.values <span class="op">@</span> eigvecs, df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>See the reference post <a href="../../posts/pca/index.html">PCA</a> for a more detailed walk-through of the linear algebra.</p>
</section>
<section id="results" class="level3">
<h3 class="anchored" data-anchor-id="results">Results</h3>
<p>As expected, the factors we extract are linearly independent (have diagonal covariance / correlation):</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pca_factor_corr(d_start, d_end, n):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    _, _, factors, _ <span class="op">=</span> apply_pca(d_start, d_end, n)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> xf.rendering.render_df_color_range(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        pandas.DataFrame(factors).corr(),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        v_min<span class="op">=-</span><span class="fl">1.</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        v_max<span class="op">=</span><span class="fl">.1</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>pca_factor_corr(xf.dates.y(<span class="dv">2022</span>), xf.dates.y(<span class="dv">2023</span>), n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<style type="text/css">
#T_b81f2 th {
  font-size: 10pt;
}
#T_b81f2 tbody td {
  border: 1px solid black;
}
#T_b81f2 th {
  border: 1px solid black;
}
#T_b81f2 .row_heading {
  width: 150px;
  min-width: 150px;
  max-width: 150px;
}
#T_b81f2 .col_heading {
  max-width: 150px;
}
#T_b81f2_row0_col0, #T_b81f2_row1_col1, #T_b81f2_row2_col2 {
  background-color: #006837;
  color: #f1f1f1;
  font-size: 8pt;
}
#T_b81f2_row0_col1, #T_b81f2_row0_col2, #T_b81f2_row1_col0, #T_b81f2_row1_col2, #T_b81f2_row2_col0, #T_b81f2_row2_col1 {
  background-color: #17934e;
  color: #f1f1f1;
  font-size: 8pt;
}
</style>

<table id="T_b81f2" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_b81f2_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">0</th>
<th id="T_b81f2_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">1</th>
<th id="T_b81f2_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_b81f2_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">0</td>
<td id="T_b81f2_row0_col0" class="data row0 col0">1.0</td>
<td id="T_b81f2_row0_col1" class="data row0 col1">0.0</td>
<td id="T_b81f2_row0_col2" class="data row0 col2">0.0</td>
</tr>
<tr class="even">
<td id="T_b81f2_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">1</td>
<td id="T_b81f2_row1_col0" class="data row1 col0">0.0</td>
<td id="T_b81f2_row1_col1" class="data row1 col1">1.0</td>
<td id="T_b81f2_row1_col2" class="data row1 col2">0.0</td>
</tr>
<tr class="odd">
<td id="T_b81f2_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">2</td>
<td id="T_b81f2_row2_col0" class="data row2 col0">0.0</td>
<td id="T_b81f2_row2_col1" class="data row2 col1">0.0</td>
<td id="T_b81f2_row2_col2" class="data row2 col2">1.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>And are each univariate gaussian, with descending variance from PC0 down to PC2 (seen in the increasing concentration of the gaussians in the plot below):</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pca_factor_density_chart(d_start, d_end, n):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    _, _, factors, df <span class="op">=</span> apply_pca(d_start, d_end, n)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> xf.graphs.df_density_chart(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        xf.dfs.melt_with_index(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>            pandas.DataFrame(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                factors,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                columns<span class="op">=</span><span class="bu">list</span>(<span class="bu">range</span>(factors.shape[<span class="dv">1</span>])),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                index<span class="op">=</span>df.index,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            variable_as<span class="op">=</span><span class="st">"factor"</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"factor"</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"value"</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>pca_factor_density_chart(xf.dates.y(<span class="dv">2022</span>), xf.dates.y(<span class="dv">2023</span>), n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="bd0541d6-8649-4313-bab1-2ab01893afec" class="plotly-graph-div" style="height:400px; width:750px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("bd0541d6-8649-4313-bab1-2ab01893afec")) {                    Plotly.newPlot(                        "bd0541d6-8649-4313-bab1-2ab01893afec",                        [{"hovertemplate":"factor=0<br>position=%{x}<br>density=%{y}<extra></extra>","legendgroup":"0","line":{"color":"#636efa","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"0","orientation":"v","showlegend":true,"x":[-0.6857662796974182,-0.6722896129193933,-0.6588129461413682,-0.6453362793633433,-0.6318596125853182,-0.6183829458072932,-0.6049062790292682,-0.5914296122512432,-0.5779529454732182,-0.5644762786951932,-0.5509996119171682,-0.5375229451391432,-0.5240462783611182,-0.5105696115830932,-0.4970929448050682,-0.4836162780270432,-0.4701396112490182,-0.4566629444709932,-0.4431862776929682,-0.4297096109149432,-0.4162329441369182,-0.4027562773588932,-0.3892796105808682,-0.3758029438028432,-0.36232627702481823,-0.34884961024679323,-0.3353729434687682,-0.3218962766907432,-0.3084196099127182,-0.2949429431346932,-0.2814662763566682,-0.2679896095786432,-0.2545129428006182,-0.2410362760225932,-0.2275596092445682,-0.2140829424665432,-0.2006062756885182,-0.18712960891049318,-0.17365294213246818,-0.16017627535444323,-0.14669960857641817,-0.13322294179839322,-0.11974627502036816,-0.10626960824234322,-0.09279294146431816,-0.07931627468629321,-0.06583960790826815,-0.0523629411302432,-0.03888627435221825,-0.025409607574193194,-0.011932940796168245,0.0015437259818568139,0.015020392759881762,0.02849705953790682,0.04197372631593177,0.05545039309395683,0.06892705987198178,0.08240372665000684,0.09588039342803178,0.10935706020605684,0.12283372698408179,0.13631039376210685,0.1497870605401318,0.16326372731815686,0.1767403940961818,0.19021706087420676,0.20369372765223182,0.21717039443025676,0.23064706120828182,0.24412372798630677,0.25760039476433183,0.2710770615423568,0.28455372832038184,0.2980303950984068,0.31150706187643185,0.3249837286544568,0.33846039543248185,0.3519370622105069,0.36541372898853175,0.3788903957665568,0.39236706254458187,0.4058437293226067,0.41932039610063176,0.4327970628786568,0.4462737296566819,0.4597503964347067,0.4732270632127318,0.48670372999075684,0.5001803967687819,0.5136570635468067,0.5271337303248318,0.5406103971028569,0.5540870638808819,0.5675637306589068,0.5810403974369318,0.5945170642149569,0.6079937309929817,0.6214703977710068,0.6349470645490318,0.6484237313270569],"xaxis":"x","y":[0.09318762900101078,0.09756082259211273,0.10054285173590141,0.10220367004400217,0.10273979128413734,0.10246553053964087,0.10179695144235656,0.10123147928664088,0.1013258396692076,0.10267400248894613,0.10588548392338494,0.11156312095122121,0.1202787136431226,0.1325450400779948,0.14878378967116362,0.16929078086351496,0.1942020296731171,0.22346623617250605,0.2568304119867703,0.2938451278451618,0.3338939101688396,0.37624773360440256,0.4201408544819237,0.4648593120658471,0.5098294222598598,0.554691604323049,0.5993456902218081,0.6439576611972916,0.6889240177033773,0.734797539461514,0.7821854403793296,0.8316362450316019,0.883533871743236,0.938015882350315,0.9949279940690003,1.0538198649579926,1.1139794656487345,1.174496714042534,1.234342818524481,1.2924506594842664,1.347783504094294,1.39938369386745,1.4463985247915523,1.4880860646196234,1.5238079664472812,1.5530186363885428,1.5752600520037754,1.590169238731314,1.5975014368069356,1.597167169143365,1.5892767394055674,1.5741821279266721,1.5525046199355572,1.525137285623508,1.4932146895393412,1.458047500562772,1.4210261040067502,1.3835036545882993,1.3466739204567282,1.3114616059295379,1.278441924536229,1.2478020180091796,1.219350103602868,1.1925703054745087,1.1667136162836262,1.1409098887280358,1.1142832554569477,1.0860542801204673,1.0556160313813152,1.0225770947941555,0.9867709219013623,0.9482365300262415,0.9071794263542348,0.8639232709756687,0.8188622786828488,0.7724221583172876,0.7250341914077212,0.6771235857397844,0.6291101340239958,0.5814169223887545,0.5344816321502862,0.4887649310984606,0.4447514462116502,0.4029405813891752,0.36382661462319593,0.32786966239719945,0.29546086337242566,0.26688625772001695,0.24229423214362106,0.22167112093852842,0.2048287474674202,0.19140651952106402,0.1808892750537198,0.17264047784934725,0.16594863815385408,0.16008308403519775,0.15435363760454665,0.14816765575624147,0.1410776070148698,0.132813119626868],"yaxis":"y","type":"scatter"},{"hovertemplate":"factor=1<br>position=%{x}<br>density=%{y}<extra></extra>","legendgroup":"1","line":{"color":"#EF553B","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"1","orientation":"v","showlegend":true,"x":[-0.2834232449531555,-0.2769798010286659,-0.27053635710417623,-0.2640929131796866,-0.25764946925519694,-0.2512060253307073,-0.24476258140621765,-0.23831913748172798,-0.23187569355723833,-0.2254322496327487,-0.21898880570825904,-0.2125453617837694,-0.20610191785927975,-0.1996584739347901,-0.19321503001030044,-0.1867715860858108,-0.18032814216132115,-0.1738846982368315,-0.16744125431234186,-0.1609978103878522,-0.15455436646336257,-0.14811092253887292,-0.14166747861438328,-0.13522403468989364,-0.128780590765404,-0.12233714684091435,-0.1158937029164247,-0.10945025899193503,-0.10300681506744538,-0.09656337114295574,-0.0901199272184661,-0.08367648329397645,-0.0772330393694868,-0.07078959544499716,-0.06434615152050752,-0.05790270759601787,-0.05145926367152823,-0.04501581974703858,-0.03857237582254891,-0.032128931898059265,-0.02568548797356962,-0.019242044049079976,-0.012798600124590331,-0.006355156200100687,8.828772438895793e-05,0.006531731648878603,0.012975175573368247,0.019418619497857892,0.025862063422347537,0.03230550734683718,0.038748951271326826,0.04519239519581647,0.051635839120306115,0.05807928304479576,0.06452272696928546,0.0709661708937751,0.07740961481826475,0.0838530587427544,0.09029650266724404,0.09673994659173368,0.10318339051622333,0.10962683444071297,0.11607027836520262,0.12251372228969226,0.1289571662141819,0.13540061013867155,0.1418440540631612,0.14828749798765084,0.15473094191214048,0.16117438583663013,0.16761782976111977,0.17406127368560942,0.18050471761009906,0.1869481615345887,0.19339160545907835,0.19983504938356805,0.2062784933080577,0.21272193723254734,0.219165381157037,0.22560882508152658,0.23205226900601628,0.23849571293050587,0.24493915685499557,0.25138260077948515,0.25782604470397485,0.26426948862846444,0.27071293255295414,0.27715637647744384,0.28359982040193343,0.29004326432642313,0.2964867082509127,0.3029301521754024,0.309373596099892,0.3158170400243817,0.3222604839488713,0.328703927873361,0.3351473717978506,0.3415908157223403,0.3480342596468299,0.3544777035713196],"xaxis":"x","y":[0.29848301649721337,0.3260758138340979,0.3523253736529171,0.3776835376147708,0.402989789605756,0.4294112184891996,0.45834615097464876,0.4913057573318073,0.5297893613880634,0.5751676136934438,0.6285839326487649,0.6908798327380729,0.7625450955701859,0.843690138766044,0.934036039614367,1.0329177950764523,1.1392985124741732,1.2517958473624078,1.3687261245497848,1.488174685138927,1.6081013702759286,1.7264862830593424,1.8415126640578725,1.9517719929075503,2.0564640046831895,2.1555549608307656,2.24985499551173,2.3409821050362716,2.4311964312073586,2.523111252077959,2.6193116770060554,2.7219326749136497,2.832259696154096,2.9504148854315586,3.0751797421500386,3.2039838512024397,3.33306360608087,3.4577697901381295,3.5729827780776042,3.6735816294371006,3.7549092775752384,3.813179679592,3.845782635529984,3.851456211155379,3.830313594594416,3.783729154820578,3.714105703487946,3.6245594666269154,3.5185688519066844,3.3996358289058315,3.2710036430250673,3.1354622081289563,2.9952551446832825,2.8520836635329068,2.7071863802937464,2.561464009076475,2.415615402062977,2.270256207112476,2.126001387778157,1.983504918838491,1.8434610938358778,1.7065798216930994,1.5735519648101362,1.4450201778374996,1.321566596583781,1.2037222651422723,1.0919957397412008,0.9869113455248545,0.8890426026355823,0.7990247498813633,0.7175329639861194,0.6452198075060017,0.5826155036343702,0.5300056061119532,0.4873096436552116,0.4539886358431016,0.42900724781216043,0.4108676447747124,0.3977185035595905,0.3875272530681979,0.37829016388874415,0.36824665786681976,0.3560630640199242,0.3409570476773726,0.32274533827259605,0.30181124920917246,0.2790016215417612,0.25547266296561005,0.23250935252832947,0.21134365100208505,0.19299373779771048,0.17814136444318332,0.1670584866725425,0.15958839732017702,0.15518086205694978,0.1529752077731742,0.15191998159202033,0.1509131290254233,0.14894348695211476,0.14521375015658425],"yaxis":"y","type":"scatter"},{"hovertemplate":"factor=2<br>position=%{x}<br>density=%{y}<extra></extra>","legendgroup":"2","line":{"color":"#00cc96","dash":"solid"},"marker":{"symbol":"circle"},"mode":"lines","name":"2","orientation":"v","showlegend":true,"x":[-0.24291211366653442,-0.23822513975278295,-0.23353816583903148,-0.22885119192528003,-0.22416421801152855,-0.21947724409777708,-0.21479027018402563,-0.21010329627027416,-0.20541632235652268,-0.2007293484427712,-0.19604237452901974,-0.1913554006152683,-0.18666842670151682,-0.18198145278776534,-0.1772944788740139,-0.17260750496026242,-0.16792053104651095,-0.16323355713275947,-0.158546583219008,-0.15385960930525655,-0.14917263539150508,-0.1444856614777536,-0.13979868756400216,-0.13511171365025068,-0.1304247397364992,-0.12573776582274773,-0.12105079190899627,-0.11636381799524481,-0.11167684408149334,-0.10698987016774186,-0.10230289625399042,-0.09761592234023894,-0.09292894842648747,-0.088241974512736,-0.08355500059898452,-0.07886802668523307,-0.0741810527714816,-0.06949407885773012,-0.06480710494397868,-0.0601201310302272,-0.05543315711647573,-0.050746183202724254,-0.04605920928897278,-0.04137223537522133,-0.03668526146146986,-0.031998287547718385,-0.027311313633966938,-0.022624339720215464,-0.01793736580646399,-0.013250391892712515,-0.008563417978961041,-0.0038764440652095944,0.0008105298485418799,0.005497503762293354,0.0101844776760448,0.014871451589796303,0.01955842550354775,0.024245399417299196,0.028932373331050698,0.033619347244802145,0.03830632115855359,0.04299329507230509,0.04768026898605654,0.05236724289980804,0.05705421681355949,0.061741190727310935,0.06642816464106244,0.07111513855481388,0.07580211246856539,0.08048908638231683,0.08517606029606828,0.08986303420981978,0.09455000812357123,0.09923698203732267,0.10392395595107418,0.10861092986482562,0.11329790377857707,0.11798487769232857,0.12267185160608002,0.12735882551983152,0.13204579943358297,0.1367327733473344,0.14141974726108592,0.14610672117483736,0.15079369508858886,0.1554806690023403,0.16016764291609176,0.16485461682984326,0.1695415907435947,0.17422856465734615,0.17891553857109765,0.1836025124848491,0.18828948639860055,0.19297646031235205,0.1976634342261035,0.202350408139855,0.20703738205360644,0.2117243559673579,0.2164113298811094,0.22109830379486084],"xaxis":"x","y":[0.2638913405960067,0.28319686915706344,0.30014598334775683,0.31474290053793796,0.3271367005450899,0.33760160541507955,0.34653728568838,0.35449295635395717,0.3622079660068529,0.370652164173229,0.38104505106384584,0.3948354372422818,0.413632583459164,0.43909283347534817,0.472778551512553,0.516014736169494,0.5697703946853748,0.6345862337471839,0.7105593397719171,0.7973827366939442,0.8944268490067274,1.0008438955701342,1.1156762280449002,1.2379546738985494,1.3667804915272002,1.5013913926980442,1.6412155608595196,1.7859165113147903,1.9354267403889576,2.089961794247547,2.250001838153184,2.4162277999438095,2.589404966977535,2.7702176926360775,2.9590717994412343,3.155892421355464,3.3599506845009235,3.5697505819674533,3.782997806860553,3.996657694517943,4.2070938607437505,4.410266826538953,4.601965804080133,4.7780475310743205,4.934661867785634,5.06845154389184,5.1767195179046075,5.2575596766159585,5.3099449366119265,5.333763181574286,5.329789073787451,5.299581687325873,5.245305750145913,5.169487433143226,5.074731211058557,4.963437981309726,4.8375718040366,4.698519979846494,4.547077718399273,4.383566243497878,4.208066303234719,4.020723771494253,3.8220664725273994,3.6132661078307144,3.396287965382792,3.1738923533054657,2.9494808748594195,2.7268114144300872,2.509631497556554,2.3012953086779344,2.104432273375445,1.9207246998043361,1.750831031665552,1.5944641379170919,1.450606011819879,1.3178164837212485,1.1945783432147432,1.0796172251419331,0.9721421902985098,0.8719702828644891,0.7795216627800425,0.6956962158699971,0.6216628299504886,0.5586049407718112,0.5074686972206528,0.4687537440238088,0.4423737786446682,0.42759847170113974,0.4230738588059672,0.4269077785538542,0.43680165473621296,0.45020956661146244,0.4645085273585035,0.4771680372171472,0.4859103308319732,0.4888541515162136,0.48463433574913745,0.4724879953090713,0.4522972529980755,0.4245798666482528],"yaxis":"y","type":"scatter"}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"position"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"density"}},"legend":{"title":{"text":"factor"},"tracegroupgap":0},"margin":{"t":60},"autosize":false,"width":750,"height":400},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('bd0541d6-8649-4313-bab1-2ab01893afec');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>Turning to our factor weights:</p>
<div class="cell" data-execution_count="13">
<details>
<summary>Factors</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pca_weights(d_start, d_end, n):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    _, eigvecs, _, df <span class="op">=</span> apply_pca(d_start, d_end, n)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pandas.DataFrame(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        eigvecs.T,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span>df.columns,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span><span class="bu">list</span>(<span class="bu">range</span>(eigvecs.shape[<span class="dv">1</span>]))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>pca_weights(xf.dates.y(<span class="dv">2022</span>), xf.dates.y(<span class="dv">2023</span>), n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ACA FP Equity</th>
<th data-quarto-table-cell-role="th">AI FP Equity</th>
<th data-quarto-table-cell-role="th">AIR FP Equity</th>
<th data-quarto-table-cell-role="th">ALO FP Equity</th>
<th data-quarto-table-cell-role="th">APAM NA Equity</th>
<th data-quarto-table-cell-role="th">BN FP Equity</th>
<th data-quarto-table-cell-role="th">BNP FP Equity</th>
<th data-quarto-table-cell-role="th">CA FP Equity</th>
<th data-quarto-table-cell-role="th">CAP FP Equity</th>
<th data-quarto-table-cell-role="th">CS FP Equity</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">IBE SQ Equity</th>
<th data-quarto-table-cell-role="th">ITX SQ Equity</th>
<th data-quarto-table-cell-role="th">NDA FH Equity</th>
<th data-quarto-table-cell-role="th">SAN SQ Equity</th>
<th data-quarto-table-cell-role="th">BG AV Equity</th>
<th data-quarto-table-cell-role="th">BIRG ID Equity</th>
<th data-quarto-table-cell-role="th">BKT SQ Equity</th>
<th data-quarto-table-cell-role="th">CABK SQ Equity</th>
<th data-quarto-table-cell-role="th">EBS AV Equity</th>
<th data-quarto-table-cell-role="th">SAB SQ Equity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-0.060335</td>
<td>-0.040464</td>
<td>-0.066809</td>
<td>-0.076080</td>
<td>-0.074317</td>
<td>-0.028223</td>
<td>-0.065206</td>
<td>-0.018692</td>
<td>-0.062472</td>
<td>-0.048011</td>
<td>...</td>
<td>-0.027217</td>
<td>-0.046161</td>
<td>-0.050864</td>
<td>-0.062572</td>
<td>-0.054376</td>
<td>-0.054569</td>
<td>-0.043741</td>
<td>-0.042946</td>
<td>-0.076183</td>
<td>-0.058908</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-0.070421</td>
<td>0.015270</td>
<td>-0.042955</td>
<td>-0.033241</td>
<td>-0.033736</td>
<td>-0.024529</td>
<td>-0.084168</td>
<td>-0.036765</td>
<td>0.041158</td>
<td>-0.054157</td>
<td>...</td>
<td>0.017941</td>
<td>-0.017879</td>
<td>-0.040327</td>
<td>-0.087104</td>
<td>-0.058716</td>
<td>-0.095620</td>
<td>-0.106794</td>
<td>-0.115320</td>
<td>-0.105358</td>
<td>-0.143965</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.029703</td>
<td>0.000996</td>
<td>0.004294</td>
<td>0.035607</td>
<td>-0.085798</td>
<td>0.046632</td>
<td>0.034311</td>
<td>-0.026233</td>
<td>0.018673</td>
<td>0.005721</td>
<td>...</td>
<td>-0.024447</td>
<td>0.025555</td>
<td>-0.012960</td>
<td>0.011640</td>
<td>0.021233</td>
<td>0.043145</td>
<td>0.032449</td>
<td>0.003381</td>
<td>0.053300</td>
<td>0.037243</td>
</tr>
</tbody>
</table>

<p>3 rows × 370 columns</p>
</div>
</div>
</div>
<p>One way to visualise them is with a simple bar chart:</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pca_factor_weight_chart(d_start, d_end, n):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> pca_weights(d_start, d_end, n)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(weights.index)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> xf.graphs.df_facet_bar_chart(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        xf.dfs.melt_with_index(weights, index_as<span class="op">=</span><span class="st">"factor"</span>),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"variable"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"value"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        facet<span class="op">=</span><span class="st">"factor"</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>pca_factor_weight_chart(xf.dates.y(<span class="dv">2022</span>), xf.dates.y(<span class="dv">2023</span>), n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="18d0eb44-a998-4c85-befb-a4a5cba9f84c" class="plotly-graph-div" style="height:1200px; width:750px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("18d0eb44-a998-4c85-befb-a4a5cba9f84c")) {                    Plotly.newPlot(                        "18d0eb44-a998-4c85-befb-a4a5cba9f84c",                        [{"alignmentgroup":"True","hovertemplate":"factor=0<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["ACA FP Equity","AI FP Equity","AIR FP Equity","ALO FP Equity","APAM NA Equity","BN FP Equity","BNP FP Equity","CA FP Equity","CAP FP Equity","CS FP Equity","DG FP Equity","DSY FP Equity","EL FP Equity","EN FP Equity","ENGI FP Equity","ERF FP Equity","GLE FP Equity","HO FP Equity","KER FP Equity","LR FP Equity","MC FP Equity","ML FP Equity","MT NA Equity","OR FP Equity","ORA FP Equity","PUB FP Equity","RI FP Equity","RMS FP Equity","RNO FP Equity","SAF FP Equity","SAN FP Equity","SGO FP Equity","SOLB BB Equity","STLAP FP Equity","STMPA FP Equity","SU FP Equity","TEP FP Equity","TTE FP Equity","UMG NA Equity","URW NA Equity","VIE FP Equity","VIV FP Equity","WLN FP Equity","1COV GY Equity","ADS GY Equity","AIR GY Equity","ALV GY Equity","BAS GY Equity","BAYN GY Equity","BMW GY Equity","BNR GY Equity","CBK GY Equity","CON GY Equity","DB1 GY Equity","DBK GY Equity","DPW GY Equity","DTE GY Equity","EOAN GY Equity","FME GY Equity","FRE GY Equity","HEI GY Equity","HEN3 GY Equity","IFX GY Equity","LIN GY Equity","MBG GY Equity","MRK GY Equity","MTX GY Equity","MUV2 GY Equity","PAH3 GY Equity","QIA GY Equity","RWE GY Equity","SAP GY Equity","SHL GY Equity","SIE GY Equity","SRT3 GY Equity","SY1 GY Equity","VNA GY Equity","VOW3 GY Equity","ZAL GY Equity","AAL LN Equity","ABF LN Equity","ADM LN Equity","AHT LN Equity","ANTO LN Equity","AUTO LN Equity","AV/ LN Equity","AVV LN Equity","AZN LN Equity","BA/ LN Equity","BARC LN Equity","BATS LN Equity","BDEV LN Equity","BKG LN Equity","BLND LN Equity","BME LN Equity","BNZL LN Equity","BP/ LN Equity","BRBY LN Equity","BT/A LN Equity","CCH LN Equity","CPG LN Equity","CRDA LN Equity","CRH LN Equity","DCC LN Equity","DGE LN Equity","ENT LN Equity","EXPN LN Equity","FLTR LN Equity","FRES LN Equity","GLEN LN Equity","GSK LN Equity","HL/ LN Equity","HLMA LN Equity","HSBA LN Equity","IAG LN Equity","IHG LN Equity","III LN Equity","IMB LN Equity","INF LN Equity","ITRK LN Equity","JD/ LN Equity","KGF LN Equity","LAND LN Equity","LGEN LN Equity","LLOY LN Equity","LSEG LN Equity","MNDI LN Equity","MNG LN Equity","MRO LN Equity","NG/ LN Equity","NWG LN Equity","NXT LN Equity","OCDO LN Equity","PHNX LN Equity","PRU LN Equity","PSH LN Equity","PSN LN Equity","PSON LN Equity","REL LN Equity","RIO LN Equity","RKT LN Equity","RMV LN Equity","RR/ LN Equity","RS1 LN Equity","RTO LN Equity","SBRY LN Equity","SDR LN Equity","SGE LN Equity","SGRO LN Equity","SKG LN Equity","SMDS LN Equity","SMIN LN Equity","SMT LN Equity","SN/ LN Equity","SPX LN Equity","SSE LN Equity","STAN LN Equity","STJ LN Equity","SVT LN Equity","TSCO LN Equity","TW/ LN Equity","ULVR LN Equity","UU/ LN Equity","VOD LN Equity","WPP LN Equity","WTB LN Equity","ABBN SE Equity","ALC SE Equity","CFR SE Equity","CSGN SE Equity","GEBN SE Equity","GIVN SE Equity","HOLN SE Equity","LOGN SE Equity","LONN SE Equity","NESN SE Equity","NOVN SE Equity","PGHN SE Equity","ROG SE Equity","SCMN SE Equity","SIKA SE Equity","SLHN SE Equity","SREN SE Equity","UBSG SE Equity","ZURN SE Equity","ABB SS Equity","ALFA SS Equity","ALIV SS Equity","ASSAB SS Equity","ATCOA SS Equity","ATCOB SS Equity","AZN SS Equity","BOL SS Equity","ELUXB SS Equity","ERICB SS Equity","ESSITYB SS Equity","EVO SS Equity","GETIB SS Equity","HEXAB SS Equity","HMB SS Equity","INVEB SS Equity","KINVB SS Equity","NDA SS Equity","SAND SS Equity","SCAB SS Equity","SEBA SS Equity","SHBA SS Equity","SINCH SS Equity","SKFB SS Equity","SWEDA SS Equity","TEL2B SS Equity","TELIA SS Equity","VOLVB SS Equity","ACS SM Equity","ACX SM Equity","AENA SM Equity","AMS SM Equity","ANA SM Equity","BBVA SM Equity","BKT SM Equity","CABK SM Equity","CLNX SM Equity","COL SM Equity","ELE SM Equity","ENG SM Equity","FDR SM Equity","FER SM Equity","GRF SM Equity","IAG SM Equity","IBE SM Equity","IDR SM Equity","ITX SM Equity","MAP SM Equity","MEL SM Equity","MRL SM Equity","MTS SM Equity","NTGY SM Equity","RED SM Equity","REP SM Equity","ROVI SM Equity","SAB SM Equity","SAN SM Equity","SLR SM Equity","TEF SM Equity","AMP IM Equity","AZM IM Equity","BAMI IM Equity","CPR IM Equity","DIA IM Equity","ENEL IM Equity","ENI IM Equity","FBK IM Equity","G IM Equity","ISP IM Equity","LDO IM Equity","MB IM Equity","MONC IM Equity","NEXI IM Equity","PRY IM Equity","PST IM Equity","REC IM Equity","SRG IM Equity","STLAM IM Equity","TEN IM Equity","TIT IM Equity","TITR IM Equity","TRN IM Equity","UCG IM Equity","ALTR PL Equity","BCP PL Equity","COR PL Equity","CTT PL Equity","EDP PL Equity","EDPR PL Equity","EGL PL Equity","GALP PL Equity","GVOLT PL Equity","JMT PL Equity","NOS PL Equity","NVG PL Equity","RENE PL Equity","SEM PL Equity","SON PL Equity","ABN NA Equity","AD NA Equity","ADYEN NA Equity","AGN NA Equity","AGS BB Equity","AKZA NA Equity","ASM NA Equity","ASML NA Equity","BESI NA Equity","DSM NA Equity","GLPG NA Equity","HEIA NA Equity","IMCD NA Equity","INGA NA Equity","KPN NA Equity","LIGHT NA Equity","NN NA Equity","PHIA NA Equity","PRX NA Equity","RAND NA Equity","REN NA Equity","UNA NA Equity","WKL NA Equity","ABI BB Equity","ACKB BB Equity","AED BB Equity","ARGX BB Equity","COFB BB Equity","COLR BB Equity","ELI BB Equity","GBLB BB Equity","KBC BB Equity","PROX BB Equity","SOF BB Equity","UCB BB Equity","UMI BB Equity","WDP BB Equity","AMBUB DC Equity","CARLB DC Equity","CHR DC Equity","COLOB DC Equity","DANSKE DC Equity","DEMANT DC Equity","DSV DC Equity","GMAB DC Equity","GN DC Equity","MAERSKA DC Equity","MAERSKB DC Equity","NOVOB DC Equity","NZYMB DC Equity","ORSTED DC Equity","PNDORA DC Equity","TRYG DC Equity","VWS DC Equity","AKRBP NO Equity","DNB NO Equity","EQNR NO Equity","FRO NO Equity","GOGL NO Equity","KAHOT NO Equity","MOWI NO Equity","MPCC NO Equity","NEL NO Equity","NHY NO Equity","NOD NO Equity","ORK NO Equity","RECSI NO Equity","SALM NO Equity","SCHA NO Equity","STB NO Equity","SUBC NO Equity","TEL NO Equity","TOM NO Equity","YAR NO Equity","BBVA SQ Equity","CRH ID Equity","FLTR ID Equity","IBE SQ Equity","ITX SQ Equity","NDA FH Equity","SAN SQ Equity","BG AV Equity","BIRG ID Equity","BKT SQ Equity","CABK SQ Equity","EBS AV Equity","SAB SQ Equity"],"xaxis":"x3","y":[-0.060334861278533936,-0.04046426713466644,-0.06680883467197418,-0.07607962191104889,-0.07431688159704208,-0.02822268009185791,-0.06520628184080124,-0.018691783770918846,-0.06247219815850258,-0.048010993748903275,-0.04470163583755493,-0.05265457183122635,-0.054838359355926514,-0.03122658282518387,-0.046684931963682175,-0.040617384016513824,-0.07916782796382904,0.0009715660708025098,-0.0630888119339943,-0.05172216519713402,-0.06315842270851135,-0.05953649431467056,-0.07032079994678497,-0.0478888638317585,-0.005519349593669176,-0.05787360668182373,-0.03716817870736122,-0.05893549695611,-0.08661194145679474,-0.06264002621173859,-0.013685652986168861,-0.07640770077705383,-0.06737272441387177,-0.08055680245161057,-0.07339590042829514,-0.06657034903764725,-0.03114955686032772,-0.03191313147544861,-0.05658017098903656,-0.08156245201826096,-0.06871680915355682,-0.03352074325084686,-0.07012242823839188,-0.06508313119411469,-0.0777919739484787,-0.06750810891389847,-0.046518027782440186,-0.06543298810720444,-0.03705134987831116,-0.058554086834192276,-0.05877329781651497,-0.08202425390481949,-0.08531523495912552,-0.021249370649456978,-0.07706242054700851,-0.06763308495283127,-0.030811857432127,-0.038096364587545395,-0.03325343504548073,-0.03917044401168823,-0.06725616753101349,-0.030069993808865547,-0.08395938575267792,-0.046648140996694565,-0.06984945386648178,-0.04652218893170357,-0.055646128952503204,-0.042918168008327484,-0.07563305646181107,-0.029761888086795807,-0.0330931730568409,-0.04651796817779541,-0.044590361416339874,-0.0742776021361351,-0.06788013875484467,-0.0336836576461792,-0.06294133514165878,-0.07389310747385025,-0.10692016780376434,-0.042506251484155655,-0.048617880791425705,-0.03774649649858475,-0.06607089191675186,-0.04854567348957062,-0.051290255039930344,-0.046613797545433044,-0.0410432294011116,-0.019667405635118484,0.010461507365107536,-0.06100556626915932,-0.010091585107147694,-0.056876569986343384,-0.045619454234838486,-0.0502624548971653,-0.03820570185780525,-0.02598465047776699,-0.02911396697163582,-0.053981855511665344,-0.03168293461203575,-0.0457206629216671,-0.03770842403173447,-0.0486757718026638,-0.06040595471858978,-0.036528196185827255,-0.030355539172887802,-0.0635761246085167,-0.04281358793377876,-0.06575459986925125,-0.009129718877375126,-0.030970267951488495,-0.01022707112133503,-0.058901362121105194,-0.05150330066680908,-0.03662177175283432,-0.08714356273412704,-0.05606042221188545,-0.06274228543043137,-0.01369769498705864,-0.05096114054322243,-0.036042220890522,-0.07650803029537201,-0.054565031081438065,-0.04967077076435089,-0.06410306692123413,-0.05770713835954666,-0.020497309044003487,-0.06492695957422256,-0.05333884060382843,-0.08809749037027359,-0.0123284375295043,-0.056466467678546906,-0.061290305107831955,-0.09249091893434525,-0.045883920043706894,-0.07023760676383972,-0.049830932170152664,-0.051788076758384705,-0.030996331945061684,-0.022606980055570602,-0.028500227257609367,-0.014625390991568565,-0.05515427142381668,-0.06915079057216644,-0.0638236254453659,-0.03106878325343132,-0.026287907734513283,-0.0634436085820198,-0.03130008280277252,-0.04733636602759361,-0.07594188302755356,-0.06832496076822281,-0.04238301143050194,-0.07992556691169739,-0.03360339254140854,-0.05075822398066521,-0.02607053332030773,-0.05033661797642708,-0.07602106034755707,-0.017235979437828064,-0.024367522448301315,-0.061454661190509796,-0.009769546799361706,-0.017806630581617355,-0.02072502113878727,-0.0608234666287899,-0.06732116639614105,-0.0553322434425354,-0.04332282021641731,-0.07783448696136475,-0.07941033691167831,-0.04686360061168671,-0.03535874933004379,-0.048578523099422455,-0.06523024290800095,-0.04915706813335419,-0.018753908574581146,-0.016357790678739548,-0.07163947075605392,-0.016313059255480766,-0.005742968525737524,-0.06721003353595734,-0.04397504776716232,-0.035008832812309265,-0.0671045258641243,-0.02955092117190361,-0.03876869007945061,-0.05262789502739906,-0.05670546367764473,-0.04803216829895973,-0.06402412801980972,-0.06289307773113251,-0.012400542385876179,-0.034090351313352585,-0.05243857949972153,-0.03200340270996094,-0.020850500091910362,-0.06099278852343559,-0.04309222102165222,-0.061580825597047806,-0.05745257809758186,-0.051706720143556595,-0.07786295562982559,-0.039660464972257614,-0.0640072301030159,-0.03643807768821716,-0.04505843669176102,-0.029567621648311615,-0.09668032824993134,-0.05406723544001579,-0.038557328283786774,-0.018108900636434555,-0.01550067588686943,-0.05636909604072571,-0.037586797028779984,-0.06209398806095123,-0.04026654735207558,-0.05722381919622421,-0.022573279216885567,-0.06367097795009613,-0.04374147951602936,-0.042946185916662216,-0.03295531123876572,-0.051897600293159485,-0.02721875160932541,-0.011327804066240788,-0.07690899819135666,-0.03777109086513519,-0.04382108896970749,-0.08557833731174469,-0.027218161150813103,-0.0456472672522068,-0.04615920037031174,-0.03050375171005726,-0.06248856335878372,-0.05049298331141472,-0.07054973393678665,-0.023868661373853683,-0.010936287231743336,-0.019624728709459305,-0.038660913705825806,-0.058908041566610336,-0.06257625669240952,-0.025352731347084045,-0.01586966961622238,-0.053726159036159515,-0.06994834542274475,-0.07113202661275864,-0.04159880056977272,-0.045041970908641815,-0.048341695219278336,-0.03286223113536835,-0.07283809781074524,-0.04289047047495842,-0.07325922697782516,-0.016600921750068665,-0.05912972241640091,-0.07653151452541351,-0.07142260670661926,-0.05721158906817436,-0.05917799845337868,-0.04196407273411751,-0.023840662091970444,-0.08072908222675323,-0.03485838323831558,-0.06601326167583466,-0.07006901502609253,-0.022198878228664398,-0.07505980134010315,-0.03533061966300011,-0.06656759977340698,-0.018434995785355568,-0.04786285385489464,-0.019271571189165115,-0.022713638842105865,-0.030889999121427536,-0.021858613938093185,-0.021458422765135765,-0.02343297004699707,-0.018844246864318848,-0.03165818005800247,-0.005825378466397524,-0.022924879565835,-0.026360752061009407,-0.055811360478401184,-0.0165371336042881,-0.09346076846122742,-0.0576590858399868,-0.05001034215092659,-0.06168469786643982,-0.08379192650318146,-0.08151179552078247,-0.08975008875131607,-0.04778983071446419,-0.03021654300391674,-0.0309150330722332,-0.0573592372238636,-0.06966343522071838,-0.009380299597978592,-0.07262621819972992,-0.050314031541347504,-0.05468778684735298,-0.07187670469284058,-0.06163258105516434,-0.02344551682472229,-0.010479367338120937,-0.017965417355298996,-0.04235942289233208,-0.03547191247344017,-0.039518896490335464,-0.0195977371186018,-0.04035826027393341,-0.03045046143233776,-0.016794927418231964,-0.046561844646930695,-0.0632748082280159,-0.02267383225262165,-0.06556123495101929,-0.015131574124097824,-0.0504763163626194,-0.05407363921403885,-0.06951430439949036,-0.03598833084106445,-0.02336902916431427,-0.03508304804563522,-0.04468010365962982,-0.06087423488497734,-0.05462147668004036,-0.030896807089447975,-0.07706017047166824,-0.05890653654932976,-0.062061384320259094,-0.017575707286596298,-0.033675987273454666,-0.02150297909975052,-0.08685038983821869,-0.0273171104490757,-0.04586612060666084,-0.0007350857486017048,-0.03446824848651886,0.009490612894296646,-0.003786711720749736,-0.036150362342596054,-0.09398995339870453,-0.026798902079463005,-0.04307850822806358,-0.07821975648403168,-0.0375506766140461,-0.08280039578676224,-0.006536104250699282,-0.05633172392845154,-0.018036479130387306,-0.0648573487997055,-0.048602305352687836,-0.0244449432939291,-0.012992162257432938,-0.05071915313601494,-0.032257821410894394,-0.06367097795009613,-0.05981997773051262,-0.06768304854631424,-0.027217144146561623,-0.04616057500243187,-0.05086410418152809,-0.06257180124521255,-0.054375581443309784,-0.05456851050257683,-0.04374147951602936,-0.042946185916662216,-0.07618308067321777,-0.058908067643642426],"yaxis":"y3","type":"bar"},{"alignmentgroup":"True","hovertemplate":"factor=1<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["ACA FP Equity","AI FP Equity","AIR FP Equity","ALO FP Equity","APAM NA Equity","BN FP Equity","BNP FP Equity","CA FP Equity","CAP FP Equity","CS FP Equity","DG FP Equity","DSY FP Equity","EL FP Equity","EN FP Equity","ENGI FP Equity","ERF FP Equity","GLE FP Equity","HO FP Equity","KER FP Equity","LR FP Equity","MC FP Equity","ML FP Equity","MT NA Equity","OR FP Equity","ORA FP Equity","PUB FP Equity","RI FP Equity","RMS FP Equity","RNO FP Equity","SAF FP Equity","SAN FP Equity","SGO FP Equity","SOLB BB Equity","STLAP FP Equity","STMPA FP Equity","SU FP Equity","TEP FP Equity","TTE FP Equity","UMG NA Equity","URW NA Equity","VIE FP Equity","VIV FP Equity","WLN FP Equity","1COV GY Equity","ADS GY Equity","AIR GY Equity","ALV GY Equity","BAS GY Equity","BAYN GY Equity","BMW GY Equity","BNR GY Equity","CBK GY Equity","CON GY Equity","DB1 GY Equity","DBK GY Equity","DPW GY Equity","DTE GY Equity","EOAN GY Equity","FME GY Equity","FRE GY Equity","HEI GY Equity","HEN3 GY Equity","IFX GY Equity","LIN GY Equity","MBG GY Equity","MRK GY Equity","MTX GY Equity","MUV2 GY Equity","PAH3 GY Equity","QIA GY Equity","RWE GY Equity","SAP GY Equity","SHL GY Equity","SIE GY Equity","SRT3 GY Equity","SY1 GY Equity","VNA GY Equity","VOW3 GY Equity","ZAL GY Equity","AAL LN Equity","ABF LN Equity","ADM LN Equity","AHT LN Equity","ANTO LN Equity","AUTO LN Equity","AV/ LN Equity","AVV LN Equity","AZN LN Equity","BA/ LN Equity","BARC LN Equity","BATS LN Equity","BDEV LN Equity","BKG LN Equity","BLND LN Equity","BME LN Equity","BNZL LN Equity","BP/ LN Equity","BRBY LN Equity","BT/A LN Equity","CCH LN Equity","CPG LN Equity","CRDA LN Equity","CRH LN Equity","DCC LN Equity","DGE LN Equity","ENT LN Equity","EXPN LN Equity","FLTR LN Equity","FRES LN Equity","GLEN LN Equity","GSK LN Equity","HL/ LN Equity","HLMA LN Equity","HSBA LN Equity","IAG LN Equity","IHG LN Equity","III LN Equity","IMB LN Equity","INF LN Equity","ITRK LN Equity","JD/ LN Equity","KGF LN Equity","LAND LN Equity","LGEN LN Equity","LLOY LN Equity","LSEG LN Equity","MNDI LN Equity","MNG LN Equity","MRO LN Equity","NG/ LN Equity","NWG LN Equity","NXT LN Equity","OCDO LN Equity","PHNX LN Equity","PRU LN Equity","PSH LN Equity","PSN LN Equity","PSON LN Equity","REL LN Equity","RIO LN Equity","RKT LN Equity","RMV LN Equity","RR/ LN Equity","RS1 LN Equity","RTO LN Equity","SBRY LN Equity","SDR LN Equity","SGE LN Equity","SGRO LN Equity","SKG LN Equity","SMDS LN Equity","SMIN LN Equity","SMT LN Equity","SN/ LN Equity","SPX LN Equity","SSE LN Equity","STAN LN Equity","STJ LN Equity","SVT LN Equity","TSCO LN Equity","TW/ LN Equity","ULVR LN Equity","UU/ LN Equity","VOD LN Equity","WPP LN Equity","WTB LN Equity","ABBN SE Equity","ALC SE Equity","CFR SE Equity","CSGN SE Equity","GEBN SE Equity","GIVN SE Equity","HOLN SE Equity","LOGN SE Equity","LONN SE Equity","NESN SE Equity","NOVN SE Equity","PGHN SE Equity","ROG SE Equity","SCMN SE Equity","SIKA SE Equity","SLHN SE Equity","SREN SE Equity","UBSG SE Equity","ZURN SE Equity","ABB SS Equity","ALFA SS Equity","ALIV SS Equity","ASSAB SS Equity","ATCOA SS Equity","ATCOB SS Equity","AZN SS Equity","BOL SS Equity","ELUXB SS Equity","ERICB SS Equity","ESSITYB SS Equity","EVO SS Equity","GETIB SS Equity","HEXAB SS Equity","HMB SS Equity","INVEB SS Equity","KINVB SS Equity","NDA SS Equity","SAND SS Equity","SCAB SS Equity","SEBA SS Equity","SHBA SS Equity","SINCH SS Equity","SKFB SS Equity","SWEDA SS Equity","TEL2B SS Equity","TELIA SS Equity","VOLVB SS Equity","ACS SM Equity","ACX SM Equity","AENA SM Equity","AMS SM Equity","ANA SM Equity","BBVA SM Equity","BKT SM Equity","CABK SM Equity","CLNX SM Equity","COL SM Equity","ELE SM Equity","ENG SM Equity","FDR SM Equity","FER SM Equity","GRF SM Equity","IAG SM Equity","IBE SM Equity","IDR SM Equity","ITX SM Equity","MAP SM Equity","MEL SM Equity","MRL SM Equity","MTS SM Equity","NTGY SM Equity","RED SM Equity","REP SM Equity","ROVI SM Equity","SAB SM Equity","SAN SM Equity","SLR SM Equity","TEF SM Equity","AMP IM Equity","AZM IM Equity","BAMI IM Equity","CPR IM Equity","DIA IM Equity","ENEL IM Equity","ENI IM Equity","FBK IM Equity","G IM Equity","ISP IM Equity","LDO IM Equity","MB IM Equity","MONC IM Equity","NEXI IM Equity","PRY IM Equity","PST IM Equity","REC IM Equity","SRG IM Equity","STLAM IM Equity","TEN IM Equity","TIT IM Equity","TITR IM Equity","TRN IM Equity","UCG IM Equity","ALTR PL Equity","BCP PL Equity","COR PL Equity","CTT PL Equity","EDP PL Equity","EDPR PL Equity","EGL PL Equity","GALP PL Equity","GVOLT PL Equity","JMT PL Equity","NOS PL Equity","NVG PL Equity","RENE PL Equity","SEM PL Equity","SON PL Equity","ABN NA Equity","AD NA Equity","ADYEN NA Equity","AGN NA Equity","AGS BB Equity","AKZA NA Equity","ASM NA Equity","ASML NA Equity","BESI NA Equity","DSM NA Equity","GLPG NA Equity","HEIA NA Equity","IMCD NA Equity","INGA NA Equity","KPN NA Equity","LIGHT NA Equity","NN NA Equity","PHIA NA Equity","PRX NA Equity","RAND NA Equity","REN NA Equity","UNA NA Equity","WKL NA Equity","ABI BB Equity","ACKB BB Equity","AED BB Equity","ARGX BB Equity","COFB BB Equity","COLR BB Equity","ELI BB Equity","GBLB BB Equity","KBC BB Equity","PROX BB Equity","SOF BB Equity","UCB BB Equity","UMI BB Equity","WDP BB Equity","AMBUB DC Equity","CARLB DC Equity","CHR DC Equity","COLOB DC Equity","DANSKE DC Equity","DEMANT DC Equity","DSV DC Equity","GMAB DC Equity","GN DC Equity","MAERSKA DC Equity","MAERSKB DC Equity","NOVOB DC Equity","NZYMB DC Equity","ORSTED DC Equity","PNDORA DC Equity","TRYG DC Equity","VWS DC Equity","AKRBP NO Equity","DNB NO Equity","EQNR NO Equity","FRO NO Equity","GOGL NO Equity","KAHOT NO Equity","MOWI NO Equity","MPCC NO Equity","NEL NO Equity","NHY NO Equity","NOD NO Equity","ORK NO Equity","RECSI NO Equity","SALM NO Equity","SCHA NO Equity","STB NO Equity","SUBC NO Equity","TEL NO Equity","TOM NO Equity","YAR NO Equity","BBVA SQ Equity","CRH ID Equity","FLTR ID Equity","IBE SQ Equity","ITX SQ Equity","NDA FH Equity","SAN SQ Equity","BG AV Equity","BIRG ID Equity","BKT SQ Equity","CABK SQ Equity","EBS AV Equity","SAB SQ Equity"],"xaxis":"x2","y":[-0.07042131572961807,0.015269629657268524,-0.04295478016138077,-0.03324110060930252,-0.03373568877577782,-0.024529030546545982,-0.08416803181171417,-0.03676547855138779,0.04115751385688782,-0.054156504571437836,-0.036874379962682724,0.10315512120723724,0.019793204963207245,-0.02849535644054413,-0.04149524122476578,0.07740175724029541,-0.11618977040052414,0.015329108573496342,0.015620512887835503,0.03683315962553024,0.01970694214105606,-0.02337941899895668,-0.043826837092638016,0.0418359749019146,-0.03333749249577522,-0.00918897707015276,0.013661272823810577,0.06585762649774551,-0.07148939371109009,-0.035523150116205215,-0.02787039987742901,-0.015781894326210022,-0.04335452616214752,-0.04447660595178604,0.03234945610165596,0.02627633512020111,0.013767875730991364,-0.06364211440086365,0.04644370451569557,-0.010770591907203197,-0.030350418761372566,-0.0014813318848609924,0.021314628422260284,-0.04665161669254303,0.01217358186841011,-0.043415043503046036,-0.03881295397877693,-0.05641087889671326,-0.0343269407749176,-0.0474882498383522,-0.007596183102577925,-0.1456274390220642,-0.042929671704769135,0.006068712566047907,-0.10934489220380783,0.0008573908708058298,-0.0262164156883955,-0.014320607297122478,-0.01942988857626915,-0.03125713765621185,-0.04214361682534218,-0.021134624257683754,0.028625046834349632,0.005761704407632351,-0.044946737587451935,0.04348798841238022,-0.039327338337898254,-0.05033768340945244,-0.031208114698529243,0.05603526160120964,0.0032555575016885996,0.03469749167561531,0.058588072657585144,-0.008449538610875607,0.13311702013015747,0.07944321632385254,0.03858732804656029,-0.0468437559902668,0.09943564236164093,-0.015644008293747902,-0.014347207732498646,0.009774629026651382,0.05346210300922394,-0.004830707795917988,0.05696125701069832,-0.049646299332380295,0.04527440294623375,0.0031238053925335407,0.0016539962962269783,-0.07128991186618805,-0.049081191420555115,0.022372733801603317,0.022817786782979965,-0.003886517370119691,0.022114697843790054,0.04484892264008522,-0.06930685043334961,-0.00715973973274231,-0.03633256256580353,-0.03371483460068703,-0.02106139436364174,0.08345286548137665,-0.012655331753194332,-0.01952960528433323,0.009436501190066338,0.023865673691034317,0.06097768619656563,0.030929910019040108,0.04353748634457588,-0.03194739669561386,-0.01779387705028057,0.031375255435705185,0.08536912500858307,-0.07768166810274124,-0.05850275978446007,-0.013522577472031116,0.018028268590569496,-0.05417614057660103,-0.013615582138299942,0.04030773788690567,0.04207943007349968,0.01278339046984911,-0.0005216165445744991,-0.0314025804400444,-0.06821863353252411,0.03612922877073288,-0.052231334149837494,-0.048902980983257294,-0.025756238028407097,0.009056752547621727,-0.06402360647916794,0.015720754861831665,0.12098338454961777,-0.023871175944805145,-0.022325562313199043,0.002361317863687873,0.027263347059488297,-0.016924522817134857,0.03390823304653168,-0.018621843308210373,-0.0035231339279562235,0.07044721394777298,-0.08246196806430817,0.021484389901161194,0.052502140402793884,-0.008553087711334229,0.012112502008676529,0.057133350521326065,0.06935074180364609,-0.018074456602334976,-0.018453458324074745,-0.01341773197054863,0.0580923929810524,0.007739203982055187,0.07605749368667603,0.009941836819052696,-0.10009216517210007,0.010516167618334293,0.03368723765015602,-0.014603550545871258,0.024171171709895134,-0.01555651519447565,0.030357543379068375,-0.024391721934080124,-0.01784163899719715,-0.020610390231013298,0.007213969249278307,0.03477172926068306,0.01651223935186863,-0.034661807119846344,0.06540053337812424,0.07862492650747299,-0.029461538419127464,0.05089797079563141,0.07661035656929016,0.012861790135502815,-0.01035628654062748,0.07699268311262131,0.01482148002833128,-0.015882445499300957,0.062285661697387695,-0.030377766117453575,-0.039753034710884094,-0.03931284695863724,-0.03582543879747391,0.015427003614604473,0.034226637333631516,-0.030100226402282715,0.041464537382125854,0.05559314414858818,0.051661089062690735,0.005123545881360769,-0.015752865001559258,0.029580073431134224,-0.005133287515491247,-0.008342062123119831,0.07759464532136917,0.08380872756242752,0.08016654849052429,-0.0025483244098722935,0.041738733649253845,0.12008354812860489,-0.04384833946824074,-0.0067753479816019535,-0.012577575631439686,-0.030359860509634018,-0.03635294362902641,0.16857905685901642,-0.016953686252236366,-0.026835478842258453,0.001329517108388245,-0.015150004997849464,-0.02611001953482628,-0.03053724206984043,-0.04332944378256798,-0.019022146239876747,-0.0017337525496259332,0.030939508229494095,-0.06230095028877258,-0.10679380595684052,-0.11532028764486313,0.09300190955400467,0.02327634207904339,-0.0025260737165808678,0.0018256527837365866,0.06079554930329323,0.007867774926126003,0.04600214585661888,-0.04770957678556442,0.017941171303391457,0.02046615444123745,-0.017880942672491074,-0.04994245618581772,-0.03446418419480324,0.0008339338819496334,-0.043921489268541336,0.0018469258211553097,0.0253846924751997,-0.04524509981274605,0.033452052623033524,-0.14396539330482483,-0.0870986208319664,0.08678887039422989,-0.027065467089414597,0.10579846799373627,-0.022364536300301552,-0.10407598316669464,0.037071794271469116,0.0991014838218689,-0.013576185330748558,-0.03419412672519684,-0.02935054339468479,-0.030656656250357628,-0.08353497833013535,-0.012081144377589226,-0.04219689220190048,0.03762536123394966,0.03876425698399544,0.02206660807132721,-0.038133010268211365,0.0276962723582983,0.008140133693814278,-0.04398118332028389,-0.041294217109680176,-0.028996583074331284,-0.044293176382780075,0.029945679008960724,-0.12686802446842194,-0.039242327213287354,-0.10255490243434906,-0.008142796345055103,-0.014408426359295845,0.035546015948057175,0.09006892889738083,-0.02475464530289173,-0.04594162851572037,0.03238570690155029,0.0060623884201049805,-0.012783961370587349,-0.02728298120200634,0.0077550774440169334,-0.011375308968126774,-0.030649304389953613,-0.08014851808547974,0.0007199836545623839,0.1095609962940216,-0.07472318410873413,-0.05097891017794609,0.0029551901388913393,0.08214954286813736,0.056005869060754776,0.06997174024581909,0.06434085965156555,0.012669959105551243,-0.010310634039342403,0.0681176632642746,-0.09372077882289886,-0.014184950850903988,-0.004926293157041073,-0.0748024731874466,0.01570132002234459,0.04668937623500824,-0.021414397284388542,0.035366229712963104,-0.01304074376821518,0.048618134111166,-0.02269565686583519,-0.016430923715233803,0.029499508440494537,0.05138862505555153,0.008345385082066059,0.013315976597368717,0.049906641244888306,0.01052560843527317,-0.07643725723028183,-0.03055162914097309,0.06869620084762573,0.026802008971571922,0.01100592315196991,0.0504637286067009,0.14910240471363068,-0.006935175508260727,0.08838898688554764,0.0890275239944458,-0.06178596615791321,0.09460042417049408,0.0576242059469223,0.074955053627491,0.0801282450556755,-0.0004064437816850841,0.0014279732713475823,0.042391400784254074,0.09655781090259552,0.1198374480009079,0.04755165055394173,0.010115518234670162,0.11996665596961975,-0.015401123091578484,-0.043470609933137894,-0.026481613516807556,0.004247673321515322,-0.02418319135904312,0.08767784386873245,-0.0266167800873518,-0.017216011881828308,0.08044468611478806,-0.008771942928433418,0.0861051082611084,-0.0021903356537222862,0.034962527453899384,-0.03342324495315552,0.06677685678005219,-0.05379204452037811,-0.032847240567207336,-0.016852103173732758,0.0652855709195137,-0.027003521099686623,-0.06230095773935318,-0.0071725561283528805,0.038303546607494354,0.01794149912893772,-0.01787908375263214,-0.04032713547348976,-0.08710412681102753,-0.05871555954217911,-0.09561950713396072,-0.10679379105567932,-0.11532029509544373,-0.10535755753517151,-0.14396539330482483],"yaxis":"y2","type":"bar"},{"alignmentgroup":"True","hovertemplate":"factor=2<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["ACA FP Equity","AI FP Equity","AIR FP Equity","ALO FP Equity","APAM NA Equity","BN FP Equity","BNP FP Equity","CA FP Equity","CAP FP Equity","CS FP Equity","DG FP Equity","DSY FP Equity","EL FP Equity","EN FP Equity","ENGI FP Equity","ERF FP Equity","GLE FP Equity","HO FP Equity","KER FP Equity","LR FP Equity","MC FP Equity","ML FP Equity","MT NA Equity","OR FP Equity","ORA FP Equity","PUB FP Equity","RI FP Equity","RMS FP Equity","RNO FP Equity","SAF FP Equity","SAN FP Equity","SGO FP Equity","SOLB BB Equity","STLAP FP Equity","STMPA FP Equity","SU FP Equity","TEP FP Equity","TTE FP Equity","UMG NA Equity","URW NA Equity","VIE FP Equity","VIV FP Equity","WLN FP Equity","1COV GY Equity","ADS GY Equity","AIR GY Equity","ALV GY Equity","BAS GY Equity","BAYN GY Equity","BMW GY Equity","BNR GY Equity","CBK GY Equity","CON GY Equity","DB1 GY Equity","DBK GY Equity","DPW GY Equity","DTE GY Equity","EOAN GY Equity","FME GY Equity","FRE GY Equity","HEI GY Equity","HEN3 GY Equity","IFX GY Equity","LIN GY Equity","MBG GY Equity","MRK GY Equity","MTX GY Equity","MUV2 GY Equity","PAH3 GY Equity","QIA GY Equity","RWE GY Equity","SAP GY Equity","SHL GY Equity","SIE GY Equity","SRT3 GY Equity","SY1 GY Equity","VNA GY Equity","VOW3 GY Equity","ZAL GY Equity","AAL LN Equity","ABF LN Equity","ADM LN Equity","AHT LN Equity","ANTO LN Equity","AUTO LN Equity","AV/ LN Equity","AVV LN Equity","AZN LN Equity","BA/ LN Equity","BARC LN Equity","BATS LN Equity","BDEV LN Equity","BKG LN Equity","BLND LN Equity","BME LN Equity","BNZL LN Equity","BP/ LN Equity","BRBY LN Equity","BT/A LN Equity","CCH LN Equity","CPG LN Equity","CRDA LN Equity","CRH LN Equity","DCC LN Equity","DGE LN Equity","ENT LN Equity","EXPN LN Equity","FLTR LN Equity","FRES LN Equity","GLEN LN Equity","GSK LN Equity","HL/ LN Equity","HLMA LN Equity","HSBA LN Equity","IAG LN Equity","IHG LN Equity","III LN Equity","IMB LN Equity","INF LN Equity","ITRK LN Equity","JD/ LN Equity","KGF LN Equity","LAND LN Equity","LGEN LN Equity","LLOY LN Equity","LSEG LN Equity","MNDI LN Equity","MNG LN Equity","MRO LN Equity","NG/ LN Equity","NWG LN Equity","NXT LN Equity","OCDO LN Equity","PHNX LN Equity","PRU LN Equity","PSH LN Equity","PSN LN Equity","PSON LN Equity","REL LN Equity","RIO LN Equity","RKT LN Equity","RMV LN Equity","RR/ LN Equity","RS1 LN Equity","RTO LN Equity","SBRY LN Equity","SDR LN Equity","SGE LN Equity","SGRO LN Equity","SKG LN Equity","SMDS LN Equity","SMIN LN Equity","SMT LN Equity","SN/ LN Equity","SPX LN Equity","SSE LN Equity","STAN LN Equity","STJ LN Equity","SVT LN Equity","TSCO LN Equity","TW/ LN Equity","ULVR LN Equity","UU/ LN Equity","VOD LN Equity","WPP LN Equity","WTB LN Equity","ABBN SE Equity","ALC SE Equity","CFR SE Equity","CSGN SE Equity","GEBN SE Equity","GIVN SE Equity","HOLN SE Equity","LOGN SE Equity","LONN SE Equity","NESN SE Equity","NOVN SE Equity","PGHN SE Equity","ROG SE Equity","SCMN SE Equity","SIKA SE Equity","SLHN SE Equity","SREN SE Equity","UBSG SE Equity","ZURN SE Equity","ABB SS Equity","ALFA SS Equity","ALIV SS Equity","ASSAB SS Equity","ATCOA SS Equity","ATCOB SS Equity","AZN SS Equity","BOL SS Equity","ELUXB SS Equity","ERICB SS Equity","ESSITYB SS Equity","EVO SS Equity","GETIB SS Equity","HEXAB SS Equity","HMB SS Equity","INVEB SS Equity","KINVB SS Equity","NDA SS Equity","SAND SS Equity","SCAB SS Equity","SEBA SS Equity","SHBA SS Equity","SINCH SS Equity","SKFB SS Equity","SWEDA SS Equity","TEL2B SS Equity","TELIA SS Equity","VOLVB SS Equity","ACS SM Equity","ACX SM Equity","AENA SM Equity","AMS SM Equity","ANA SM Equity","BBVA SM Equity","BKT SM Equity","CABK SM Equity","CLNX SM Equity","COL SM Equity","ELE SM Equity","ENG SM Equity","FDR SM Equity","FER SM Equity","GRF SM Equity","IAG SM Equity","IBE SM Equity","IDR SM Equity","ITX SM Equity","MAP SM Equity","MEL SM Equity","MRL SM Equity","MTS SM Equity","NTGY SM Equity","RED SM Equity","REP SM Equity","ROVI SM Equity","SAB SM Equity","SAN SM Equity","SLR SM Equity","TEF SM Equity","AMP IM Equity","AZM IM Equity","BAMI IM Equity","CPR IM Equity","DIA IM Equity","ENEL IM Equity","ENI IM Equity","FBK IM Equity","G IM Equity","ISP IM Equity","LDO IM Equity","MB IM Equity","MONC IM Equity","NEXI IM Equity","PRY IM Equity","PST IM Equity","REC IM Equity","SRG IM Equity","STLAM IM Equity","TEN IM Equity","TIT IM Equity","TITR IM Equity","TRN IM Equity","UCG IM Equity","ALTR PL Equity","BCP PL Equity","COR PL Equity","CTT PL Equity","EDP PL Equity","EDPR PL Equity","EGL PL Equity","GALP PL Equity","GVOLT PL Equity","JMT PL Equity","NOS PL Equity","NVG PL Equity","RENE PL Equity","SEM PL Equity","SON PL Equity","ABN NA Equity","AD NA Equity","ADYEN NA Equity","AGN NA Equity","AGS BB Equity","AKZA NA Equity","ASM NA Equity","ASML NA Equity","BESI NA Equity","DSM NA Equity","GLPG NA Equity","HEIA NA Equity","IMCD NA Equity","INGA NA Equity","KPN NA Equity","LIGHT NA Equity","NN NA Equity","PHIA NA Equity","PRX NA Equity","RAND NA Equity","REN NA Equity","UNA NA Equity","WKL NA Equity","ABI BB Equity","ACKB BB Equity","AED BB Equity","ARGX BB Equity","COFB BB Equity","COLR BB Equity","ELI BB Equity","GBLB BB Equity","KBC BB Equity","PROX BB Equity","SOF BB Equity","UCB BB Equity","UMI BB Equity","WDP BB Equity","AMBUB DC Equity","CARLB DC Equity","CHR DC Equity","COLOB DC Equity","DANSKE DC Equity","DEMANT DC Equity","DSV DC Equity","GMAB DC Equity","GN DC Equity","MAERSKA DC Equity","MAERSKB DC Equity","NOVOB DC Equity","NZYMB DC Equity","ORSTED DC Equity","PNDORA DC Equity","TRYG DC Equity","VWS DC Equity","AKRBP NO Equity","DNB NO Equity","EQNR NO Equity","FRO NO Equity","GOGL NO Equity","KAHOT NO Equity","MOWI NO Equity","MPCC NO Equity","NEL NO Equity","NHY NO Equity","NOD NO Equity","ORK NO Equity","RECSI NO Equity","SALM NO Equity","SCHA NO Equity","STB NO Equity","SUBC NO Equity","TEL NO Equity","TOM NO Equity","YAR NO Equity","BBVA SQ Equity","CRH ID Equity","FLTR ID Equity","IBE SQ Equity","ITX SQ Equity","NDA FH Equity","SAN SQ Equity","BG AV Equity","BIRG ID Equity","BKT SQ Equity","CABK SQ Equity","EBS AV Equity","SAB SQ Equity"],"xaxis":"x","y":[0.029703395441174507,0.0009964092168956995,0.004293530248105526,0.0356065072119236,-0.08579762279987335,0.046631887555122375,0.03431053087115288,-0.026232818141579628,0.01867300271987915,0.0057210056111216545,0.025971446186304092,0.009949017316102982,0.05000389367341995,0.0012196976458653808,0.0204431414604187,0.03488250449299812,0.0446186363697052,-0.11710266768932343,0.00931961927562952,0.016605952754616737,0.024872267618775368,0.02659190632402897,-0.1252942532300949,0.03611069545149803,-0.0003497012658044696,0.011689561419188976,0.027868326753377914,0.03191691264510155,0.049561142921447754,0.011112694628536701,-0.015384403988718987,0.020472286269068718,-0.002073433483019471,0.014504545368254185,0.01470158714801073,0.022930163890123367,0.03433508053421974,-0.11994428187608719,-0.014493854716420174,0.009656453505158424,0.013349984772503376,-0.007540729828178883,0.03464493900537491,-0.0014995117671787739,0.026810860261321068,0.005897975526750088,-0.0013968765269964933,0.005201567430049181,-0.0040994067676365376,0.015480888076126575,-0.012330237776041031,0.05116410180926323,0.033017031848430634,0.020718859508633614,0.02099883370101452,0.04039639234542847,0.012091775424778461,0.0037249457091093063,-0.00887389201670885,0.0074511016719043255,0.012252230197191238,0.020877305418252945,0.01251112949103117,0.0007667043246328831,0.0043725790455937386,0.05446932092308998,-0.027157314121723175,0.006362259387969971,0.020904168486595154,0.028797850012779236,-0.027910374104976654,0.01631818525493145,0.013483528047800064,0.026341332122683525,0.02710646763443947,0.018705641850829124,-0.009959296323359013,0.012541022151708603,0.045235905796289444,-0.2011934071779251,0.039739832282066345,0.007665453944355249,-0.0002700354380067438,-0.1701229363679886,0.011495230719447136,-0.011202775873243809,0.04535925015807152,-0.009148732759058475,-0.09901240468025208,-0.003583188634365797,-0.00805709883570671,0.012621672824025154,0.0020349733531475067,-0.007138596381992102,0.0056500970385968685,-0.015038607642054558,-0.14882664382457733,0.02844032272696495,0.007169933523982763,0.09497645497322083,0.010426758788526058,0.024263322353363037,0.02957271970808506,-0.034172315150499344,0.03910103440284729,-0.011423340998589993,0.03980482369661331,0.026057640090584755,-0.1077641099691391,-0.17845392227172852,-0.0007889607222750783,0.037615567445755005,0.01752454601228237,-0.026502719148993492,0.030805524438619614,-0.006678357254713774,0.014863460324704647,-0.0045851836912333965,0.017540056258440018,0.02259269915521145,0.0661553367972374,0.03268212080001831,-0.011267781257629395,0.0027272163424640894,0.022754555568099022,0.01983211562037468,0.05562498793005943,-0.013339973986148834,0.04530632495880127,-0.0182179044932127,-0.0030006675515323877,0.03493506833910942,0.02227778732776642,-0.01644950360059738,-0.026576509699225426,-0.0037274977657943964,0.016428740695118904,0.001793357776477933,0.025459837168455124,-0.13892862200737,0.042249903082847595,0.02566235139966011,-0.026754368096590042,0.02693880908191204,0.026710085570812225,-0.0017055339412763715,0.013720418326556683,0.02981671504676342,0.011660072952508926,0.04895905405282974,0.046076156198978424,-0.0036249940749257803,0.014618945308029652,0.02098275162279606,0.018458200618624687,-0.02373381517827511,-0.03125552088022232,0.04498527944087982,-0.016266074031591415,0.0015826418530195951,0.02031746692955494,0.04815151169896126,-0.008270030841231346,0.012901019304990768,0.027163557708263397,0.02269054390490055,-0.017513656988739967,-0.009556364268064499,0.010576070286333561,-0.024572977796196938,0.011328773573040962,0.003338856855407357,0.011447163298726082,-0.0037161437794566154,0.013185398653149605,0.02023126557469368,-0.011529942974448204,-0.011067050509154797,0.00339272222481668,-0.02368595264852047,-0.0036193877458572388,-0.02657974511384964,0.004368829540908337,-0.015273090451955795,-0.016805138438940048,-0.02217530831694603,-0.010760411620140076,0.006121537648141384,-0.0013688587350770831,-0.010824955068528652,-0.007065440062433481,-0.02002064697444439,-0.1948467195034027,0.029289470985531807,-0.00882289744913578,0.050730954855680466,-0.014959295280277729,0.02327737770974636,-0.0071305930614471436,0.029554231092333794,-0.009890258312225342,-0.013711688108742237,-0.012801741249859333,-0.015124933794140816,-0.04830664023756981,-0.004249630495905876,-0.007678050547838211,-0.011600980535149574,-0.004803844261914492,0.0037824001628905535,-0.004631801042705774,-0.006064231973141432,-0.0008520461269654334,-0.0209446270018816,-0.06975878030061722,0.0063011315651237965,0.012736067175865173,-0.06232688948512077,0.01767522282898426,0.03244870901107788,0.003380995476618409,-0.00976917240768671,-0.016745207831263542,-0.021846631541848183,-0.06140093132853508,0.006903611123561859,0.00239196652546525,-0.053398970514535904,0.017372777685523033,-0.02444917894899845,-0.013363482430577278,0.0255543552339077,-0.007785894442349672,-0.00938304141163826,-0.011166006326675415,-0.12608760595321655,-0.05369555950164795,-0.04151996970176697,-0.16880281269550323,-0.010931290686130524,0.037242643535137177,0.011628750711679459,-0.15886348485946655,-0.0046117352321743965,0.031532786786556244,0.011601107195019722,0.011387541890144348,0.039602480828762054,0.002791021950542927,-0.013473328202962875,-0.13274163007736206,0.019725559279322624,-0.021021034568548203,0.03165346011519432,-0.11741281300783157,0.012465470470488071,0.012569048441946507,0.033276792615652084,-0.0305898729711771,0.005486810579895973,0.04853566735982895,-0.038478050380945206,0.01573917642235756,-0.23873382806777954,-0.01936732605099678,-0.0015880274586379528,-0.034639548510313034,0.04638094827532768,-0.05559716373682022,-0.006918682251125574,-0.00497522484511137,-0.01876923441886902,-0.06160157173871994,-0.08690529316663742,-0.03208427503705025,-0.18575772643089294,-0.08626936376094818,0.0010581922251731157,-0.02522759512066841,-0.02937581203877926,-0.040568191558122635,-0.016513844951987267,-0.030154364183545113,0.019047025591135025,0.015516472980380058,0.06963301450014114,-0.022640151903033257,-0.0022750478237867355,0.030959879979491234,-0.023611370474100113,-0.026397163048386574,-0.004429908934980631,0.020156653597950935,-0.004884661640971899,0.04769999533891678,0.001717128325253725,0.04981173202395439,-0.02140181139111519,0.029543181881308556,0.010940998792648315,0.008620050735771656,-0.025857947766780853,0.03560013324022293,0.012281394563615322,0.03195149451494217,0.025793936103582382,0.028436120599508286,-0.010812332853674889,-0.010902934707701206,-0.0002805555996019393,-0.00591047341004014,0.02258821204304695,-0.054720401763916016,0.009698533453047276,0.03175859525799751,-0.029374850913882256,0.012166287750005722,-0.011269164271652699,-0.08189511299133301,-0.0009313508053310215,-0.012239637784659863,0.035198528319597244,0.027773238718509674,-0.011445987038314342,-0.010062924586236477,-0.0033903459552675486,-0.04142327234148979,-0.019081421196460724,0.003123707138001919,-0.05495882034301758,-0.051002729684114456,-0.013661054894328117,-0.025119297206401825,-0.09858407080173492,0.03362041339278221,-0.020628327503800392,-0.1534576117992401,-0.23543161153793335,-0.01824301853775978,-0.19503366947174072,-0.1900852620601654,-0.16052722930908203,0.006522815208882093,-0.04402624070644379,-0.0694376528263092,-0.14821608364582062,-0.19132426381111145,0.012996676377952099,0.012833576649427414,-0.13121429085731506,-0.037688713520765305,0.010862457565963268,-0.021106375381350517,-0.17627499997615814,-0.009253145195543766,0.022546805441379547,-0.07665395736694336,0.017675237730145454,0.012564469128847122,0.01651168428361416,-0.024446766823530197,0.025555036962032318,-0.012960145249962807,0.011640079319477081,0.021232960745692253,0.043145183473825455,0.032448701560497284,0.0033809980377554893,0.05329981446266174,0.037242691963911057],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,0.98],"title":{"text":"variable"},"showticklabels":true},"yaxis":{"anchor":"x","domain":[0.0,0.3133333333333333],"title":{"text":"value"},"showticklabels":true},"xaxis2":{"anchor":"y2","domain":[0.0,0.98],"showticklabels":true},"yaxis2":{"anchor":"x2","domain":[0.34333333333333327,0.6566666666666665],"title":{"text":"value"},"showticklabels":true},"xaxis3":{"anchor":"y3","domain":[0.0,0.98],"showticklabels":true},"yaxis3":{"anchor":"x3","domain":[0.6866666666666665,0.9999999999999998],"title":{"text":"value"},"showticklabels":true},"annotations":[{"font":{},"showarrow":false,"text":"factor=2","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.15666666666666665,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"factor=1","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.4999999999999999,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"factor=0","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.8433333333333332,"yanchor":"middle","yref":"paper"}],"legend":{"tracegroupgap":0},"margin":{"t":60},"barmode":"relative","autosize":false,"width":750,"height":1200},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('18d0eb44-a998-4c85-befb-a4a5cba9f84c');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>However, as one can see, given that we end up with a single weight per ticker per factor, it’s fairly difficult to know how to interpret each of the above.</p>
<p>The one thing we can tell from the above, is that our first factor is (more or less) the same sign for equity ticker in our universe, representing some kind of general market beta factor (a point we’ll return to in the discussion below).</p>
</section>
<section id="sector-index-aggregation" class="level3">
<h3 class="anchored" data-anchor-id="sector-index-aggregation">Sector &amp; Index Aggregation</h3>
<p>To try and make sense of our weights, we can try averaging them up into something more manageable.</p>
<p>For instance, using a function mapping us from a ticker to a GICS sector:</p>
<div class="cell" data-execution_count="15">
<details>
<summary>Sector Tickers</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sector_tickers(d_start, d_end, n):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    _, _, df <span class="op">=</span> fit_pca(d_start, d_end, n)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    tickers <span class="op">=</span> xt.iTuple(df.columns)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        s: tickers.<span class="bu">filter</span>(</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>            in_universe, df <span class="op">=</span> dfs_sectors[s], threshold<span class="op">=</span><span class="fl">1.</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        ) <span class="cf">for</span> s <span class="kw">in</span> <span class="bu">sorted</span>(dfs_sectors.keys())</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Certain industries will be under or over-represented in our universe, in a given period:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sector_map_chart(d_start, d_end, n):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    sector_map <span class="op">=</span> sector_tickers(d_start, d_end, n)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> xf.graphs.df_bar_chart(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>        pandas.DataFrame({</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>            s: [<span class="bu">len</span>(v)] <span class="cf">for</span> s, v <span class="kw">in</span> sector_map.items()</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        }).melt(),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"variable"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"value"</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>sector_map_chart(xf.dates.y(<span class="dv">2022</span>), xf.dates.y(<span class="dv">2023</span>), n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="b39c941d-12c2-4b23-a5d6-5c47c5f0bdd7" class="plotly-graph-div" style="height:400px; width:750px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("b39c941d-12c2-4b23-a5d6-5c47c5f0bdd7")) {                    Plotly.newPlot(                        "b39c941d-12c2-4b23-a5d6-5c47c5f0bdd7",                        [{"alignmentgroup":"True","hovertemplate":"variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["GICS 10","GICS 15","GICS 20","GICS 25","GICS 30","GICS 35","GICS 40","GICS 45","GICS 50","GICS 55","GICS 60"],"xaxis":"x","y":[6,14,19,10,16,8,35,5,11,9,3],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"variable"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"value"}},"legend":{"tracegroupgap":0},"margin":{"t":60},"barmode":"relative","autosize":false,"width":750,"height":400},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('b39c941d-12c2-4b23-a5d6-5c47c5f0bdd7');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>So, we’ll scale our average relative to the sector representation during the period in question, returning something like the below:</p>
<div class="cell" data-execution_count="17">
<details>
<summary>Sector Weights Chart</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pca_sector_weights_chart(d_start, d_end, n):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> pca_weights(d_start, d_end, n)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    sector_map <span class="op">=</span> sector_tickers(d_start, d_end, n)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    sector_weights <span class="op">=</span> pandas.DataFrame({</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        s: weights[tickers.pipe(<span class="bu">list</span>)].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> s, tickers <span class="kw">in</span> sector_map.items()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    scaled_weights <span class="op">=</span> pandas.DataFrame({</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        s: sector_weights[s] <span class="op">/</span> <span class="bu">len</span>(ts)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> s, ts <span class="kw">in</span> sector_map.items()</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> xf.graphs.df_facet_bar_chart(</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        xf.dfs.melt_with_index(scaled_weights, index_as<span class="op">=</span><span class="st">"factor"</span>),</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"variable"</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"value"</span>,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>        facet<span class="op">=</span><span class="st">"factor"</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>pca_sector_weights_chart(xf.dates.y(<span class="dv">2022</span>), xf.dates.y(<span class="dv">2023</span>), n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>                            <div id="40f15de6-47b2-411d-a631-ed4c2ccc2946" class="plotly-graph-div" style="height:1200px; width:750px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("40f15de6-47b2-411d-a631-ed4c2ccc2946")) {                    Plotly.newPlot(                        "40f15de6-47b2-411d-a631-ed4c2ccc2946",                        [{"alignmentgroup":"True","hovertemplate":"factor=0<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["GICS 10","GICS 15","GICS 20","GICS 25","GICS 30","GICS 35","GICS 40","GICS 45","GICS 50","GICS 55","GICS 60"],"xaxis":"x3","y":[-0.02141139656305313,-0.043972887098789215,-0.04909656196832657,-0.053465019911527634,-0.025451738387346268,-0.019917836412787437,-0.055713217705488205,-0.04358818382024765,-0.023401187732815742,-0.027590734884142876,-0.046763826161623],"yaxis":"y3","type":"bar"},{"alignmentgroup":"True","hovertemplate":"factor=1<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["GICS 10","GICS 15","GICS 20","GICS 25","GICS 30","GICS 35","GICS 40","GICS 45","GICS 50","GICS 55","GICS 60"],"xaxis":"x2","y":[-0.04528617486357689,-0.0006043504108674824,0.010699247010052204,-0.007525615394115448,-0.012390941381454468,0.0006485925987362862,-0.0673365443944931,0.029664242640137672,-0.020003722980618477,0.010492214933037758,0.0013124169781804085],"yaxis":"y2","type":"bar"},{"alignmentgroup":"True","hovertemplate":"factor=2<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["GICS 10","GICS 15","GICS 20","GICS 25","GICS 30","GICS 35","GICS 40","GICS 45","GICS 50","GICS 55","GICS 60"],"xaxis":"x","y":[-0.1569373458623886,-0.06391549855470657,-0.01873423531651497,0.018071163445711136,0.020420808345079422,-0.0066737025044858456,0.009330183267593384,0.008524306118488312,-0.003748989198356867,-0.023784494027495384,-0.008105617016553879],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,0.98],"title":{"text":"variable"},"showticklabels":true},"yaxis":{"anchor":"x","domain":[0.0,0.3133333333333333],"title":{"text":"value"},"showticklabels":true},"xaxis2":{"anchor":"y2","domain":[0.0,0.98],"showticklabels":true},"yaxis2":{"anchor":"x2","domain":[0.34333333333333327,0.6566666666666665],"title":{"text":"value"},"showticklabels":true},"xaxis3":{"anchor":"y3","domain":[0.0,0.98],"showticklabels":true},"yaxis3":{"anchor":"x3","domain":[0.6866666666666665,0.9999999999999998],"title":{"text":"value"},"showticklabels":true},"annotations":[{"font":{},"showarrow":false,"text":"factor=2","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.15666666666666665,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"factor=1","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.4999999999999999,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"factor=0","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.8433333333333332,"yanchor":"middle","yref":"paper"}],"legend":{"tracegroupgap":0},"margin":{"t":60},"barmode":"relative","autosize":false,"width":750,"height":1200},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('40f15de6-47b2-411d-a631-ed4c2ccc2946');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>As one can see, this is much more easily interpretible.</p>
<p>We can go through a similar process for averaging our weights by equity index.</p>
<div class="cell" data-execution_count="18">
<details>
<summary>Index Tickers</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> index_tickers(d_start, d_end, n):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    _, _, df <span class="op">=</span> fit_pca(d_start, d_end, n)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    tickers <span class="op">=</span> xt.iTuple(df.columns)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        i: tickers.<span class="bu">filter</span>(</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>            in_universe, df <span class="op">=</span> dfs_indices[i], threshold<span class="op">=</span><span class="fl">1.</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        ) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">sorted</span>(dfs_indices.keys())</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Where, again, certain indices will be over or under-represented in our universe:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> index_map_chart(d_start, d_end, n):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    index_map <span class="op">=</span> index_tickers(d_start, d_end, n)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> xf.graphs.df_bar_chart(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        pandas.DataFrame({</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>            i: [<span class="bu">len</span>(v)] <span class="cf">for</span> i, v <span class="kw">in</span> index_map.items()</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        }).melt(),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"variable"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"value"</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>index_map_chart(xf.dates.y(<span class="dv">2022</span>), xf.dates.y(<span class="dv">2023</span>), n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="37cba76e-fc84-4c72-801a-b0672f55bf8f" class="plotly-graph-div" style="height:400px; width:750px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("37cba76e-fc84-4c72-801a-b0672f55bf8f")) {                    Plotly.newPlot(                        "37cba76e-fc84-4c72-801a-b0672f55bf8f",                        [{"alignmentgroup":"True","hovertemplate":"variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["AEX Index","BEL20 Index","CAC Index","DAX Index","IBEX Index","IT30 Index","KFX Index","OBX Index","OMX Index","PSI20 Index","SMI Index","SX5E Index","SX7E Index","UKX Index"],"xaxis":"x","y":[10,9,24,15,10,0,7,8,20,6,0,21,11,41],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"variable"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"value"}},"legend":{"tracegroupgap":0},"margin":{"t":60},"barmode":"relative","autosize":false,"width":750,"height":400},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('37cba76e-fc84-4c72-801a-b0672f55bf8f');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>Which we’ll account for in our averaging just as we did for our sectors, giving us back something like the below:</p>
<div class="cell" data-execution_count="20">
<details>
<summary>Index Weights Chart</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pca_index_weights_chart(d_start, d_end, n):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> pca_weights(d_start, d_end, n)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    index_map <span class="op">=</span> index_tickers(d_start, d_end, n)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    index_weights <span class="op">=</span> pandas.DataFrame({</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        i: weights[tickers.pipe(<span class="bu">list</span>)].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, tickers <span class="kw">in</span> index_map.items()</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    scaled_weights <span class="op">=</span> pandas.DataFrame({</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        i: index_weights[i] <span class="op">/</span> <span class="bu">len</span>(ts)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, ts <span class="kw">in</span> index_map.items()</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> xf.graphs.df_facet_bar_chart(</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        xf.dfs.melt_with_index(index_weights, index_as<span class="op">=</span><span class="st">"factor"</span>),</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"variable"</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"value"</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        facet<span class="op">=</span><span class="st">"factor"</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>pca_index_weights_chart(xf.dates.y(<span class="dv">2022</span>), xf.dates.y(<span class="dv">2023</span>), n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div>                            <div id="1e946afe-50eb-4ccb-9d58-3a12b876920d" class="plotly-graph-div" style="height:1200px; width:750px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("1e946afe-50eb-4ccb-9d58-3a12b876920d")) {                    Plotly.newPlot(                        "1e946afe-50eb-4ccb-9d58-3a12b876920d",                        [{"alignmentgroup":"True","hovertemplate":"factor=0<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["AEX Index","BEL20 Index","CAC Index","DAX Index","IBEX Index","IT30 Index","KFX Index","OBX Index","OMX Index","PSI20 Index","SMI Index","SX5E Index","SX7E Index","UKX Index"],"xaxis":"x3","y":[-0.44779452681541443,-0.39821910858154297,-1.199094295501709,-0.795678436756134,-0.40511223673820496,0.0,-0.29446911811828613,-0.18736165761947632,-0.8696829080581665,-0.17740201950073242,0.0,-0.9925840497016907,-0.7616636753082275,-1.5054707527160645],"yaxis":"y3","type":"bar"},{"alignmentgroup":"True","hovertemplate":"factor=1<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["AEX Index","BEL20 Index","CAC Index","DAX Index","IBEX Index","IT30 Index","KFX Index","OBX Index","OMX Index","PSI20 Index","SMI Index","SX5E Index","SX7E Index","UKX Index"],"xaxis":"x2","y":[-0.004598192870616913,-0.16733907163143158,-0.5883588790893555,-0.4008054733276367,-0.4985956847667694,0.0,0.24924689531326294,-0.21140940487384796,0.05349941924214363,-0.11575506627559662,0.0,-0.6130109429359436,-1.084451675415039,-0.8344066739082336],"yaxis":"y2","type":"bar"},{"alignmentgroup":"True","hovertemplate":"factor=2<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["AEX Index","BEL20 Index","CAC Index","DAX Index","IBEX Index","IT30 Index","KFX Index","OBX Index","OMX Index","PSI20 Index","SMI Index","SX5E Index","SX7E Index","UKX Index"],"xaxis":"x","y":[0.1281196027994156,-0.06290483474731445,0.2737640142440796,0.16557027399539948,-0.14457391202449799,0.0,-0.25952836871147156,-0.6750558614730835,-0.13281559944152832,-0.13935787975788116,0.0,-0.03070438653230667,0.36406534910202026,-0.6050565838813782],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,0.98],"title":{"text":"variable"},"showticklabels":true},"yaxis":{"anchor":"x","domain":[0.0,0.3133333333333333],"title":{"text":"value"},"showticklabels":true},"xaxis2":{"anchor":"y2","domain":[0.0,0.98],"showticklabels":true},"yaxis2":{"anchor":"x2","domain":[0.34333333333333327,0.6566666666666665],"title":{"text":"value"},"showticklabels":true},"xaxis3":{"anchor":"y3","domain":[0.0,0.98],"showticklabels":true},"yaxis3":{"anchor":"x3","domain":[0.6866666666666665,0.9999999999999998],"title":{"text":"value"},"showticklabels":true},"annotations":[{"font":{},"showarrow":false,"text":"factor=2","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.15666666666666665,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"factor=1","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.4999999999999999,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"factor=0","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.8433333333333332,"yanchor":"middle","yref":"paper"}],"legend":{"tracegroupgap":0},"margin":{"t":60},"barmode":"relative","autosize":false,"width":750,"height":1200},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('1e946afe-50eb-4ccb-9d58-3a12b876920d');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>With which, we can get back to the fun part - interpretation!</p>
</section>
<section id="interpretation---by-sector" class="level3">
<h3 class="anchored" data-anchor-id="interpretation---by-sector">Interpretation - By Sector</h3>
<p>Let’s try plotting our factor sector weights for the period 2020 - 2022:</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>pca_sector_weights_chart(xf.dates.y(<span class="dv">2020</span>), xf.dates.y(<span class="dv">2022</span>), n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="d383a29f-a73e-4f5d-a54b-23ab7e8e62df" class="plotly-graph-div" style="height:1200px; width:750px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("d383a29f-a73e-4f5d-a54b-23ab7e8e62df")) {                    Plotly.newPlot(                        "d383a29f-a73e-4f5d-a54b-23ab7e8e62df",                        [{"alignmentgroup":"True","hovertemplate":"factor=0<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["GICS 10","GICS 15","GICS 20","GICS 25","GICS 30","GICS 35","GICS 40","GICS 45","GICS 50","GICS 55","GICS 60"],"xaxis":"x3","y":[0.06979241222143173,0.04319999739527702,0.053501736372709274,0.058859068900346756,0.027659296989440918,0.02587597817182541,0.06925713270902634,0.04019937664270401,0.036498527973890305,0.033039677888154984,0.04797907546162605],"yaxis":"y3","type":"bar"},{"alignmentgroup":"True","hovertemplate":"factor=1<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["GICS 10","GICS 15","GICS 20","GICS 25","GICS 30","GICS 35","GICS 40","GICS 45","GICS 50","GICS 55","GICS 60"],"xaxis":"x2","y":[0.03073273040354252,-0.026820341125130653,-0.01713167317211628,-0.00401717284694314,-0.026446063071489334,-0.05695001780986786,0.03927356004714966,-0.042601995170116425,-0.0077848853543400764,-0.05128856003284454,0.03600582852959633],"yaxis":"y2","type":"bar"},{"alignmentgroup":"True","hovertemplate":"factor=2<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["GICS 10","GICS 15","GICS 20","GICS 25","GICS 30","GICS 35","GICS 40","GICS 45","GICS 50","GICS 55","GICS 60"],"xaxis":"x","y":[0.045096129179000854,0.02762986533343792,-0.024247899651527405,-0.0353294312953949,0.02639041654765606,0.011082001961767673,0.030803833156824112,-0.014024701900780201,0.06439675390720367,0.03243355080485344,-0.031121795997023582],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,0.98],"title":{"text":"variable"},"showticklabels":true},"yaxis":{"anchor":"x","domain":[0.0,0.3133333333333333],"title":{"text":"value"},"showticklabels":true},"xaxis2":{"anchor":"y2","domain":[0.0,0.98],"showticklabels":true},"yaxis2":{"anchor":"x2","domain":[0.34333333333333327,0.6566666666666665],"title":{"text":"value"},"showticklabels":true},"xaxis3":{"anchor":"y3","domain":[0.0,0.98],"showticklabels":true},"yaxis3":{"anchor":"x3","domain":[0.6866666666666665,0.9999999999999998],"title":{"text":"value"},"showticklabels":true},"annotations":[{"font":{},"showarrow":false,"text":"factor=2","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.15666666666666665,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"factor=1","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.4999999999999999,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"factor=0","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.8433333333333332,"yanchor":"middle","yref":"paper"}],"legend":{"tracegroupgap":0},"margin":{"t":60},"barmode":"relative","autosize":false,"width":750,"height":1200},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('d383a29f-a73e-4f5d-a54b-23ab7e8e62df');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>As one can see, the first factor has the same sign for every sector, and if we dig into particular components, seems to roughly match our intuitive notion of index beta (ie. higher beta sectors having larger weights):</p>
<ul>
<li>Higher beta: 10 (Energy), 20 (Industrials), 25 (Discretionary), 40 (Financials).</li>
<li>Lower beta: 30 (Staples), 35 (Health), 50 (Media / Telcos), 55 (Utilities).</li>
</ul>
<p>Whilst the exact loadings will vary from period to period, the first - and most important (in a variance-explanatory sense) - component will nearly always tend to be some kind of general market-beta factor.</p>
<p>The second and third factors will, however, vary a little more from period to period.</p>
<p>For instance, whilst for 2020 - 2022, the second factor seems to be picking up something like a risk-on vs risk-off factor, separating between:</p>
<ul>
<li>Energy (10), Financials (40), Real Estate (60).</li>
<li>Materials (15), Health(35), Tech (45), Utilities (55).</li>
</ul>
<p>If we run the same procedure over 2007 to 2010:</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>pca_sector_weights_chart(xf.dates.y(<span class="dv">2007</span>), xf.dates.y(<span class="dv">2010</span>), n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="4e4cd912-ea8a-43f2-938c-4d1da00799c2" class="plotly-graph-div" style="height:1200px; width:750px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("4e4cd912-ea8a-43f2-938c-4d1da00799c2")) {                    Plotly.newPlot(                        "4e4cd912-ea8a-43f2-938c-4d1da00799c2",                        [{"alignmentgroup":"True","hovertemplate":"factor=0<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["GICS 10","GICS 15","GICS 20","GICS 25","GICS 30","GICS 35","GICS 40","GICS 45","GICS 50","GICS 55","GICS 60"],"xaxis":"x3","y":[-0.05328066274523735,-0.05833255127072334,-0.05881497263908386,-0.0525551363825798,-0.032172806560993195,-0.024767545983195305,-0.07652750611305237,-0.038927532732486725,-0.0342312753200531,-0.031740590929985046,-0.04465334489941597],"yaxis":"y3","type":"bar"},{"alignmentgroup":"True","hovertemplate":"factor=1<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["GICS 10","GICS 15","GICS 20","GICS 25","GICS 30","GICS 35","GICS 40","GICS 45","GICS 50","GICS 55","GICS 60"],"xaxis":"x2","y":[-0.06245097517967224,-0.05293983221054077,-0.03538675606250763,-0.010201184079051018,-0.023540176451206207,-0.02378435619175434,0.05579540878534317,-0.03027973137795925,-0.01790573261678219,-0.033458516001701355,0.028452547267079353],"yaxis":"y2","type":"bar"},{"alignmentgroup":"True","hovertemplate":"factor=2<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["GICS 10","GICS 15","GICS 20","GICS 25","GICS 30","GICS 35","GICS 40","GICS 45","GICS 50","GICS 55","GICS 60"],"xaxis":"x","y":[-0.040958624333143234,-0.04956790432333946,0.014698480255901814,0.0456230603158474,0.04202837496995926,0.054749228060245514,0.01957891322672367,0.04235633835196495,0.037466052919626236,0.02562367171049118,0.05183279514312744],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,0.98],"title":{"text":"variable"},"showticklabels":true},"yaxis":{"anchor":"x","domain":[0.0,0.3133333333333333],"title":{"text":"value"},"showticklabels":true},"xaxis2":{"anchor":"y2","domain":[0.0,0.98],"showticklabels":true},"yaxis2":{"anchor":"x2","domain":[0.34333333333333327,0.6566666666666665],"title":{"text":"value"},"showticklabels":true},"xaxis3":{"anchor":"y3","domain":[0.0,0.98],"showticklabels":true},"yaxis3":{"anchor":"x3","domain":[0.6866666666666665,0.9999999999999998],"title":{"text":"value"},"showticklabels":true},"annotations":[{"font":{},"showarrow":false,"text":"factor=2","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.15666666666666665,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"factor=1","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.4999999999999999,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"factor=0","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.8433333333333332,"yanchor":"middle","yref":"paper"}],"legend":{"tracegroupgap":0},"margin":{"t":60},"barmode":"relative","autosize":false,"width":750,"height":1200},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('4e4cd912-ea8a-43f2-938c-4d1da00799c2');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>Our second factor is almost entirely dominated by Financials and Real Estate (40 and 60) versus everything else, and our third by Energy and Materials (10 and 15) versus everything else.</p>
<p>This, given the 2007-2010 (housing driven) financial crisis (and the ensuing commodity market reaction to global growth concerns), does actually make sense.</p>
<p>Let’s now compare to the period 2014 to 2016:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>pca_sector_weights_chart(xf.dates.y(<span class="dv">2014</span>), xf.dates.y(<span class="dv">2016</span>), n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="1cf9adea-fc1f-48af-8a45-69ac28075145" class="plotly-graph-div" style="height:1200px; width:750px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("1cf9adea-fc1f-48af-8a45-69ac28075145")) {                    Plotly.newPlot(                        "1cf9adea-fc1f-48af-8a45-69ac28075145",                        [{"alignmentgroup":"True","hovertemplate":"factor=0<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["GICS 10","GICS 15","GICS 20","GICS 25","GICS 30","GICS 35","GICS 40","GICS 45","GICS 50","GICS 55","GICS 60"],"xaxis":"x3","y":[0.052321214228868484,0.04959467053413391,0.05119752511382103,0.04544875770807266,0.04077767953276634,0.04505623131990433,0.05847936496138573,0.050430625677108765,0.04518381878733635,0.0419553779065609,0.030172357335686684],"yaxis":"y3","type":"bar"},{"alignmentgroup":"True","hovertemplate":"factor=1<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["GICS 10","GICS 15","GICS 20","GICS 25","GICS 30","GICS 35","GICS 40","GICS 45","GICS 50","GICS 55","GICS 60"],"xaxis":"x2","y":[-0.11332353204488754,-0.03329547867178917,-0.001433354802429676,0.01188585814088583,0.002097613178193569,0.03008889965713024,0.010618116706609726,0.00959479995071888,0.01512582041323185,0.011242147535085678,0.02449219487607479],"yaxis":"y2","type":"bar"},{"alignmentgroup":"True","hovertemplate":"factor=2<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["GICS 10","GICS 15","GICS 20","GICS 25","GICS 30","GICS 35","GICS 40","GICS 45","GICS 50","GICS 55","GICS 60"],"xaxis":"x","y":[0.0004076597688253969,0.03045273944735527,0.023903394117951393,0.046728964895009995,0.05116790160536766,0.04928277060389519,-0.02941889688372612,0.02440372109413147,0.026547284796833992,0.01684878207743168,0.04341261088848114],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,0.98],"title":{"text":"variable"},"showticklabels":true},"yaxis":{"anchor":"x","domain":[0.0,0.3133333333333333],"title":{"text":"value"},"showticklabels":true},"xaxis2":{"anchor":"y2","domain":[0.0,0.98],"showticklabels":true},"yaxis2":{"anchor":"x2","domain":[0.34333333333333327,0.6566666666666665],"title":{"text":"value"},"showticklabels":true},"xaxis3":{"anchor":"y3","domain":[0.0,0.98],"showticklabels":true},"yaxis3":{"anchor":"x3","domain":[0.6866666666666665,0.9999999999999998],"title":{"text":"value"},"showticklabels":true},"annotations":[{"font":{},"showarrow":false,"text":"factor=2","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.15666666666666665,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"factor=1","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.4999999999999999,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"factor=0","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.8433333333333332,"yanchor":"middle","yref":"paper"}],"legend":{"tracegroupgap":0},"margin":{"t":60},"barmode":"relative","autosize":false,"width":750,"height":1200},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('1cf9adea-fc1f-48af-8a45-69ac28075145');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>Here, the Energy and Materials (10 and 15) vs everything else is much more prominent, given the global commodity wobble (at least partly driven by the rise in US shale oil production).</p>
<p>We also see an extremely concentrated third component of financials (40) versus everything else, probably driven by another flare up of the 2010’s EU sovereign debt crises.</p>
<p>What we’re seeing here is that because PCA doesn’t have any underlying model for how different equities relate together - it just strips out the ways in which they happened to co-move during a given period - it doesn’t have anything to anchor itself on, and thus returns (samples of) somewhat different factors, depending on which period we run it on.</p>
<p>Whilst this might reflect a genuine causal difference in the factors driving overall single-name equity returns during different periods, it also might reflect sheer co-occurence (correlation, as they say, does not necessarily mean causation).</p>
</section>
<section id="interpretation---by-index" class="level3">
<h3 class="anchored" data-anchor-id="interpretation---by-index">Interpretation - By Index</h3>
<p>We get similar results (though personally much less useful), if we instead aggregate by index.</p>
<p>For instance, we can see the same commodity wobble in the Norwegian (OBX) and to some extent UK (UKX) weighting over 2014 to 2016 (given their respective commodity exposures):</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pca_index_weights_chart(xf.dates.y(<span class="dv">2014</span>), xf.dates.y(<span class="dv">2016</span>), n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="f194bbbe-330c-49b4-b48b-beb0747bebbe" class="plotly-graph-div" style="height:1200px; width:750px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("f194bbbe-330c-49b4-b48b-beb0747bebbe")) {                    Plotly.newPlot(                        "f194bbbe-330c-49b4-b48b-beb0747bebbe",                        [{"alignmentgroup":"True","hovertemplate":"factor=0<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["AEX Index","BEL20 Index","CAC Index","DAX Index","IBEX Index","IT30 Index","KFX Index","OBX Index","OMX Index","PSI20 Index","SMI Index","SX5E Index","SX7E Index","UKX Index"],"xaxis":"x3","y":[0.520048201084137,0.3999690115451813,1.428586721420288,0.8728127479553223,0.6278703212738037,0.0,0.33629110455513,0.32308828830718994,0.9579230546951294,0.3781258463859558,0.0,1.2599823474884033,0.7956952452659607,1.6142148971557617],"yaxis":"y3","type":"bar"},{"alignmentgroup":"True","hovertemplate":"factor=1<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["AEX Index","BEL20 Index","CAC Index","DAX Index","IBEX Index","IT30 Index","KFX Index","OBX Index","OMX Index","PSI20 Index","SMI Index","SX5E Index","SX7E Index","UKX Index"],"xaxis":"x2","y":[0.19171777367591858,0.08843100070953369,0.29029953479766846,0.14521223306655884,-0.011834347620606422,0.0,0.05997564643621445,-0.5164292454719543,0.006165625527501106,0.12004491686820984,0.0,0.21509534120559692,0.277537077665329,-0.28513455390930176],"yaxis":"y2","type":"bar"},{"alignmentgroup":"True","hovertemplate":"factor=2<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["AEX Index","BEL20 Index","CAC Index","DAX Index","IBEX Index","IT30 Index","KFX Index","OBX Index","OMX Index","PSI20 Index","SMI Index","SX5E Index","SX7E Index","UKX Index"],"xaxis":"x","y":[0.29534363746643066,0.2066546380519867,0.42233654856681824,0.47525322437286377,-0.43449342250823975,0.0,0.1584789752960205,0.10330314934253693,0.6449217200279236,-0.23568004369735718,0.0,0.44783487915992737,-0.8108363151550293,1.5034593343734741],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,0.98],"title":{"text":"variable"},"showticklabels":true},"yaxis":{"anchor":"x","domain":[0.0,0.3133333333333333],"title":{"text":"value"},"showticklabels":true},"xaxis2":{"anchor":"y2","domain":[0.0,0.98],"showticklabels":true},"yaxis2":{"anchor":"x2","domain":[0.34333333333333327,0.6566666666666665],"title":{"text":"value"},"showticklabels":true},"xaxis3":{"anchor":"y3","domain":[0.0,0.98],"showticklabels":true},"yaxis3":{"anchor":"x3","domain":[0.6866666666666665,0.9999999999999998],"title":{"text":"value"},"showticklabels":true},"annotations":[{"font":{},"showarrow":false,"text":"factor=2","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.15666666666666665,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"factor=1","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.4999999999999999,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"factor=0","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.8433333333333332,"yanchor":"middle","yref":"paper"}],"legend":{"tracegroupgap":0},"margin":{"t":60},"barmode":"relative","autosize":false,"width":750,"height":1200},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('f194bbbe-330c-49b4-b48b-beb0747bebbe');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>Whereas we can see something like a peripherals (Spain &amp; Portugal) vs European core factor, if we run over the peak of the EU sovereign debt crisis (2010-2013):</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>pca_index_weights_chart(xf.dates.y(<span class="dv">2010</span>), xf.dates.y(<span class="dv">2013</span>), n<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="a82bbec3-f90f-4c4d-8533-637d09b4abe4" class="plotly-graph-div" style="height:1200px; width:750px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("a82bbec3-f90f-4c4d-8533-637d09b4abe4")) {                    Plotly.newPlot(                        "a82bbec3-f90f-4c4d-8533-637d09b4abe4",                        [{"alignmentgroup":"True","hovertemplate":"factor=0<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["AEX Index","BEL20 Index","CAC Index","DAX Index","IBEX Index","IT30 Index","KFX Index","OBX Index","OMX Index","PSI20 Index","SMI Index","SX5E Index","SX7E Index","UKX Index"],"xaxis":"x3","y":[0.47573715448379517,0.4715536832809448,1.4642488956451416,0.7392683625221252,0.5793935656547546,0.0,0.29279425740242004,0.4363099932670593,0.9824957847595215,0.25460854172706604,0.0,1.158621907234192,0.989666223526001,1.6123794317245483],"yaxis":"y3","type":"bar"},{"alignmentgroup":"True","hovertemplate":"factor=1<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["AEX Index","BEL20 Index","CAC Index","DAX Index","IBEX Index","IT30 Index","KFX Index","OBX Index","OMX Index","PSI20 Index","SMI Index","SX5E Index","SX7E Index","UKX Index"],"xaxis":"x2","y":[-0.12597334384918213,0.012751735746860504,-0.11035627871751785,-0.3050563931465149,0.7065970301628113,0.0,-0.22451220452785492,-0.33215761184692383,-0.8067553639411926,0.19613608717918396,0.0,0.0834931805729866,1.1702231168746948,-0.905542254447937],"yaxis":"y2","type":"bar"},{"alignmentgroup":"True","hovertemplate":"factor=2<br>variable=%{x}<br>value=%{y}<extra></extra>","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["AEX Index","BEL20 Index","CAC Index","DAX Index","IBEX Index","IT30 Index","KFX Index","OBX Index","OMX Index","PSI20 Index","SMI Index","SX5E Index","SX7E Index","UKX Index"],"xaxis":"x","y":[0.20930106937885284,0.11223410069942474,0.7092599868774414,0.5830135941505432,0.45316508412361145,0.0,-0.14742779731750488,-0.2011317014694214,0.09111770987510681,0.024739136919379234,0.0,0.9686785340309143,-0.012082882225513458,1.2383276224136353],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,0.98],"title":{"text":"variable"},"showticklabels":true},"yaxis":{"anchor":"x","domain":[0.0,0.3133333333333333],"title":{"text":"value"},"showticklabels":true},"xaxis2":{"anchor":"y2","domain":[0.0,0.98],"showticklabels":true},"yaxis2":{"anchor":"x2","domain":[0.34333333333333327,0.6566666666666665],"title":{"text":"value"},"showticklabels":true},"xaxis3":{"anchor":"y3","domain":[0.0,0.98],"showticklabels":true},"yaxis3":{"anchor":"x3","domain":[0.6866666666666665,0.9999999999999998],"title":{"text":"value"},"showticklabels":true},"annotations":[{"font":{},"showarrow":false,"text":"factor=2","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.15666666666666665,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"factor=1","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.4999999999999999,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"factor=0","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.8433333333333332,"yanchor":"middle","yref":"paper"}],"legend":{"tracegroupgap":0},"margin":{"t":60},"barmode":"relative","autosize":false,"width":750,"height":1200},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('a82bbec3-f90f-4c4d-8533-637d09b4abe4');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>Where we can see how the EU financials index (SX7E) is moving with the IBEX and PSI (lending support to the idea that this is some kind of financial stress factor).</p>
</section>
<section id="limitations" class="level3">
<h3 class="anchored" data-anchor-id="limitations">Limitations</h3>
<p>As noted above, vanilla PCA - at least in the eigendecomposition form above - requires a full data matrix, with no missing values. This can be quite limiting, especially when dealing with real data (as opposed to the above, somewhat stylised, daily equity returns).</p>
<p>That being said, this is fairly simple to deal with via, for instance, an <a href="../pca_equity_irregulary/index.qmd">irregular covariance</a> matrix, or via some kind of <a href="../kernel_pca/index.qmd">kernel</a> function.</p>
<p>More concering, as we’ve seen, is that without any kind of prior model for how different features ‘should’ be related to one another, the factors we extract can often vary quite significantly when ran over different samples periods.</p>
<p>Indeed, given that we fit a single weight for each ticker in our universe in a given period, the problem is in fact somewhat worse. Under the hood of the sector / index aggregation above, our weights were defined over entirely different sets of tickers (specifically, their different daily return covariances), as our universe rolled through time.</p>
<p>As our universe changes, we’re thus left without any factor weights for new tickers entering our universe (forcing us, for instance, to continually refit our factor matrices).</p>
<p>There are, however, a number of ways that we can deal with this - for instance, by first mapping our tickers into some kind of latent space, before assigning them factor weights (see <a href="../lgp_pca_equity/index.qmd">here</a>).</p>
</section>
<section id="related-posts" class="level3">
<h3 class="anchored" data-anchor-id="related-posts">Related posts</h3>
<p>See <a href="../pca_rates/index.qmd">here</a> for a similar post using PCA to decompose bond / swap yield curve factors.</p>
<p>See <a href="../../posts/pca/index.html">here</a> for a toy PCA example intended to help build up intuition for the geometry of the eigendecomposition above, and <a href="../../posts/orthogonality/index.html">here</a> for some notes on orthogonality (on which said decomposition relies).</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>